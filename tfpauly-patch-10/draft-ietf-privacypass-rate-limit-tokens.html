<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Rate-Limited Token Issuance Protocol</title>
<meta content="Scott Hendrickson" name="author">
<meta content="Jana Iyengar" name="author">
<meta content="Tommy Pauly" name="author">
<meta content="Steven Valdez" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document specifies a variant of the Privacy Pass issuance protocol
that allows for tokens to be rate-limited on a per-origin basis. This
enables origins to use tokens for use cases that need to restrict access
from anonymous clients. 
    " name="description">
<meta content="xml2rfc 3.18.2" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-ietf-privacypass-rate-limit-tokens-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.18.2
    Python 3.11.6
    ConfigArgParse 1.5.3
    google-i18n-address 3.1.0
    intervaltree 3.1.0
    Jinja2 3.1.2
    lxml 4.9.3
    platformdirs 3.11.0
    pycountry 22.3.5
    PyYAML 6.0
    requests 2.31.0
    setuptools 67.7.2
    six 1.16.0
    wcwidth 0.2.9
-->
<link href="draft-ietf-privacypass-rate-limit-tokens.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Cabin Condensed';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Cabin Condensed SemiBold'), local('CabinCondensed-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/cabincondensed-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
}
:is(ol, ul) :is(ol, ul) {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  line-height: 1;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
}
dl.olPercent {
  --indent: 5ch;
}
dl > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl.dlNewline > dt {
  float: none;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
dl.olPercent > dt {
  min-width: calc(var(--indent) - 2ch);
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:first-child, .break:first-child + *) {
  margin-top: 0;
}
:is(dl.compact, .dlCompact) > dd > :is(:last-child) {
  margin-bottom: 0;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0;
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    overflow-x: auto;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
}
a.pilcrow[href] { color: var(--pilcrow-weak); }
a.pilcrow[href]:hover { text-decoration: none; }
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
}
#identifiers dt {
  width: var(--identifier-width);
  min-width: var(--identifier-width);
  clear: left;
  float: left;
  text-align: right;
  margin-right: 1ch;
}
#identifiers dd {
  margin: 0;
  margin-left: calc(1em + var(--identifier-width)) !important;
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 2px 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 10ch;
  margin-right: 1.5ch;
}
.references dt:target::before {
  content: "⇒";
  width: 15px;
  margin: 0 10px 0 -25px;
}
.references dd {
  margin-left: 12ch !important;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul :is(p, li) {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
  .toplink {
    display: none;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Provide styling for table cell text alignment */
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Rate-Limited Tokens</td>
<td class="right">October 2023</td>
</tr></thead>
<tfoot><tr>
<td class="left">Hendrickson, et al.</td>
<td class="center">Expires 3 May 2024</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-ietf-privacypass-rate-limit-tokens-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2023-10-31" class="published">31 October 2023</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2024-05-03">3 May 2024</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">S. Hendrickson</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">J. Iyengar</div>
<div class="org">Fastly</div>
</div>
<div class="author">
      <div class="author-name">T. Pauly</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">S. Valdez</div>
<div class="org">Google LLC</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Cloudflare</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Rate-Limited Token Issuance Protocol</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies a variant of the Privacy Pass issuance protocol
that allows for tokens to be rate-limited on a per-origin basis. This
enables origins to use tokens for use cases that need to restrict access
from anonymous clients.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-discussion-venues">
<a href="#name-discussion-venues" class="section-name selfRef">Discussion Venues</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">Discussion of this document takes place on the
    Privacy Pass Working Group mailing list (privacy-pass@ietf.org),
    which is archived at <span><a href="https://mailarchive.ietf.org/arch/browse/privacy-pass/">https://mailarchive.ietf.org/arch/browse/privacy-pass/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">Source for this draft and an issue tracker can be found at
    <span><a href="https://github.com/ietf-wg-privacypass/draft-ietf-privacypass-rate-limit-tokens">https://github.com/ietf-wg-privacypass/draft-ietf-privacypass-rate-limit-tokens</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 3 May 2024.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="auto internal xref">1.1</a>.  <a href="#name-motivation" class="internal xref">Motivation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.2">
                <p id="section-toc.1-1.1.2.2.1" class="keepWithNext"><a href="#section-1.2" class="auto internal xref">1.2</a>.  <a href="#name-protocol-overview" class="internal xref">Protocol Overview</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.3">
                <p id="section-toc.1-1.1.2.3.1" class="keepWithNext"><a href="#section-1.3" class="auto internal xref">1.3</a>.  <a href="#name-properties-and-requirements" class="internal xref">Properties and Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-terminology" class="internal xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-configuration" class="internal xref">Configuration</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-token-challenge-requirement" class="internal xref">Token Challenge Requirements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-issuance-protocol" class="internal xref">Issuance Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-state-requirements" class="internal xref">State Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-client-state" class="internal xref">Client State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-attester-state" class="internal xref">Attester State</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-issuer-state" class="internal xref">Issuer State</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-issuance-http-headers" class="internal xref">Issuance HTTP Headers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-client-to-attester-request" class="internal xref">Client-to-Attester Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-client-behavior" class="internal xref">Client behavior</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="auto internal xref">5.3.2</a>.  <a href="#name-attester-behavior" class="internal xref">Attester behavior</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4">
                <p id="section-toc.1-1.5.2.4.1"><a href="#section-5.4" class="auto internal xref">5.4</a>.  <a href="#name-attester-to-issuer-request" class="internal xref">Attester-to-Issuer Request</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.1">
                    <p id="section-toc.1-1.5.2.4.2.1.1"><a href="#section-5.4.1" class="auto internal xref">5.4.1</a>.  <a href="#name-attester-behavior-2" class="internal xref">Attester behavior</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.4.2.2">
                    <p id="section-toc.1-1.5.2.4.2.2.1"><a href="#section-5.4.2" class="auto internal xref">5.4.2</a>.  <a href="#name-issuer-behavior" class="internal xref">Issuer behavior</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5">
                <p id="section-toc.1-1.5.2.5.1"><a href="#section-5.5" class="auto internal xref">5.5</a>.  <a href="#name-token-issuance-response" class="internal xref">Token Issuance Response</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.1">
                    <p id="section-toc.1-1.5.2.5.2.1.1"><a href="#section-5.5.1" class="auto internal xref">5.5.1</a>.  <a href="#name-issuer-behavior-2" class="internal xref">Issuer behavior</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.2">
                    <p id="section-toc.1-1.5.2.5.2.2.1"><a href="#section-5.5.2" class="auto internal xref">5.5.2</a>.  <a href="#name-attester-behavior-3" class="internal xref">Attester behavior</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.5.2.3">
                    <p id="section-toc.1-1.5.2.5.2.3.1"><a href="#section-5.5.3" class="auto internal xref">5.5.3</a>.  <a href="#name-client-behavior-2" class="internal xref">Client behavior</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.6">
                <p id="section-toc.1-1.5.2.6.1"><a href="#section-5.6" class="auto internal xref">5.6</a>.  <a href="#name-penalization-of-invalid-cli" class="internal xref">Penalization of Invalid Clients and Issuers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-encrypting-origin-token-req" class="internal xref">Encrypting Origin Token Requests and Responses</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-client-to-issuer-encapsulat" class="internal xref">Client to Issuer Encapsulation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-issuer-to-client-encapsulat" class="internal xref">Issuer to Client Encapsulation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-issuers-origin-alias-comput" class="internal xref">Issuer's Origin Alias Computation</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="auto internal xref">7.1</a>.  <a href="#name-client-behavior-3" class="internal xref">Client Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.1">
                    <p id="section-toc.1-1.7.2.1.2.1.1"><a href="#section-7.1.1" class="auto internal xref">7.1.1</a>.  <a href="#name-request-key" class="internal xref">Request Key</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.1.2.2">
                    <p id="section-toc.1-1.7.2.1.2.2.1"><a href="#section-7.1.2" class="auto internal xref">7.1.2</a>.  <a href="#name-request-signature" class="internal xref">Request Signature</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="auto internal xref">7.2</a>.  <a href="#name-attester-behavior-client-re" class="internal xref">Attester Behavior (Client Request Validation)</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.3">
                <p id="section-toc.1-1.7.2.3.1"><a href="#section-7.3" class="auto internal xref">7.3</a>.  <a href="#name-issuer-behavior-3" class="internal xref">Issuer Behavior</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7.2.4">
                <p id="section-toc.1-1.7.2.4.1"><a href="#section-7.4" class="auto internal xref">7.4</a>.  <a href="#name-attester-behavior-index-com" class="internal xref">Attester Behavior (Index Computation)</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="auto internal xref">8.1</a>.  <a href="#name-client-secret-use" class="internal xref">Client Secret Use</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.2">
                <p id="section-toc.1-1.8.2.2.1"><a href="#section-8.2" class="auto internal xref">8.2</a>.  <a href="#name-custom-token-request-encaps" class="internal xref">Custom Token Request Encapsulation</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.3">
                <p id="section-toc.1-1.8.2.3.1"><a href="#section-8.3" class="auto internal xref">8.3</a>.  <a href="#name-channel-security" class="internal xref">Channel Security</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.4">
                <p id="section-toc.1-1.8.2.4.1"><a href="#section-8.4" class="auto internal xref">8.4</a>.  <a href="#name-token-request-unlinkability" class="internal xref">Token Request Unlinkability and Unforgeability</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.5">
                <p id="section-toc.1-1.8.2.5.1"><a href="#section-8.5" class="auto internal xref">8.5</a>.  <a href="#name-information-disclosure" class="internal xref">Information Disclosure</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8.2.6">
                <p id="section-toc.1-1.8.2.6.1"><a href="#section-8.6" class="auto internal xref">8.6</a>.  <a href="#name-rate-limit-enforcement" class="internal xref">Rate Limit Enforcement</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-privacy-considerations" class="internal xref">Privacy Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="auto internal xref">9.1</a>.  <a href="#name-client-token-state-and-orig" class="internal xref">Client Token State and Origin Tracking</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="auto internal xref">9.2</a>.  <a href="#name-origin-verification" class="internal xref">Origin Verification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.3">
                <p id="section-toc.1-1.9.2.3.1"><a href="#section-9.3" class="auto internal xref">9.3</a>.  <a href="#name-client-identification-with-" class="internal xref">Client Identification with Unique Encapsulation Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.4">
                <p id="section-toc.1-1.9.2.4.1"><a href="#section-9.4" class="auto internal xref">9.4</a>.  <a href="#name-client-identification-with-u" class="internal xref">Client Identification with Unique Per-Origin Token Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.5">
                <p id="section-toc.1-1.9.2.5.1"><a href="#section-9.5" class="auto internal xref">9.5</a>.  <a href="#name-origin-identification" class="internal xref">Origin Identification</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9.2.6">
                <p id="section-toc.1-1.9.2.6.1"><a href="#section-9.6" class="auto internal xref">9.6</a>.  <a href="#name-collusion-among-different-e" class="internal xref">Collusion Among Different Entities</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-deployment-considerations" class="internal xref">Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="auto internal xref">10.1</a>.  <a href="#name-token-key-management" class="internal xref">Token Key Management</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-iana-considerations" class="internal xref">IANA considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-token-type" class="internal xref">Token Type</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1.2.1">
                    <p id="section-toc.1-1.11.2.1.2.1.1"><a href="#section-11.1.1" class="auto internal xref">11.1.1</a>.  <a href="#name-ecdsa-based-token-type" class="internal xref">ECDSA-based Token Type</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1.2.2">
                    <p id="section-toc.1-1.11.2.1.2.2.1"><a href="#section-11.1.2" class="auto internal xref">11.1.2</a>.  <a href="#name-ed25519-based-token-type" class="internal xref">Ed25519-based Token Type</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-http-headers" class="internal xref">HTTP Headers</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="auto internal xref">12</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="auto internal xref">12.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="auto internal xref">12.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-acknowledgements" class="internal xref">Acknowledgements</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14">
            <p id="section-toc.1-1.14.1"><a href="#appendix-B" class="auto internal xref">Appendix B</a>.  <a href="#name-test-vectors" class="internal xref">Test Vectors</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.1">
                <p id="section-toc.1-1.14.2.1.1"><a href="#appendix-B.1" class="auto internal xref">B.1</a>.  <a href="#name-origin-name-encryption-test" class="internal xref">Origin Name Encryption Test Vector</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.14.2.2">
                <p id="section-toc.1-1.14.2.2.1"><a href="#appendix-B.2" class="auto internal xref">B.2</a>.  <a href="#name-issuers-origin-alias-test-v" class="internal xref">Issuer's Origin Alias Test Vector</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.15">
            <p id="section-toc.1-1.15.1"><a href="#appendix-C" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document specifies a variant of the Privacy Pass issuance protocol
(as defined in <span>[<a href="#ARCH" class="cite xref">ARCH</a>]</span>) that allows
for tokens to be rate-limited on a per-origin basis. This enables origins
to use tokens for use cases that need to restrict access from anonymous clients.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">The base Privacy Pass issuance protocol <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>
defines stateless anonymous tokens, which can either be publicly verifiable
or not.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">This variant builds upon the publicly verifiable issuance protocol that uses
RSA Blind Signatures <span>[<a href="#BLINDSIG" class="cite xref">BLINDSIG</a>]</span>, and
allows tokens to be rate-limited on a per-origin basis. This means that
a client will only be able to receive a limited number of tokens associated
with a given origin server within a fixed period of time.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This issuance protocol registers the Rate-Limited Blind RSA token type
(<a href="#iana-token-type" class="auto internal xref">Section 11.1</a>), to be used with the PrivateToken HTTP authentication
scheme defined in <span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>.<a href="#section-1-4" class="pilcrow">¶</a></p>
<div id="motivation">
<section id="section-1.1">
        <h3 id="name-motivation">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-motivation" class="section-name selfRef">Motivation</a>
        </h3>
<p id="section-1.1-1">A client that wishes to keep its IP address private can hide its IP address
using a proxy service or a VPN. However, doing so severely limits the client's
ability to access services and content, since servers might not be able to
enforce their policies without a stable and unique client identifier.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
<p id="section-1.1-2">Privacy Pass tokens in general allow clients to provide anonymous attestation
of various properties. The tokens generated by the basic issuance
protocol (<span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>) can be used to verify that a client meets a particular
bar for attestation, but cannot be used by a redeeming server to rate-limit
specific clients. This is because there is no mechanism in the issuance protocol
to link repeated client token requests in order to apply rate-limiting.<a href="#section-1.1-2" class="pilcrow">¶</a></p>
<p id="section-1.1-3">There are several use cases for rate-limiting anonymous clients that
are common on the Internet. These routinely use client IP address tracking,
among other characteristics, to implement rate-limiting.<a href="#section-1.1-3" class="pilcrow">¶</a></p>
<p id="section-1.1-4">One example of this use case is rate-limiting website accesses to a client to
help prevent abusive behavior. Operations that are sensitive to abuse, such as account
creation on a website or logging into an account, often employ rate-limiting
as a defense-in-depth strategy. Additional verification can be required by these
pages when a client exceeds a set rate-limit.<a href="#section-1.1-4" class="pilcrow">¶</a></p>
<p id="section-1.1-5">Another example of this use case is a metered paywall, where an origin limits the
number of page requests from each unique user over a period of time before the
user is required to pay for access. The origin typically resets this state
periodically, say, once per month. For example, an origin may serve ten (major
content) requests in a month before a paywall is enacted. Origins may want to
differentiate quick refreshes from distinct accesses.<a href="#section-1.1-5" class="pilcrow">¶</a></p>
<p id="section-1.1-6">For some applications, the basic issuance protocol from <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span> could be used to
implement rate limits. In particular, the 'Joint Attester and Issuer' model from <span>[<a href="#ARCH" class="cite xref">ARCH</a>]</span>
could be used to restrict the number of tokens issued to individual clients over a
time window. However, in this deployment model, the Attester and Issuer would learn all
origins used by a specific client, thereby coupling sensitive attestation and redemption
contexts. In some cases this might be a significant portion of browsing history.<a href="#section-1.1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="protocol-overview">
<section id="section-1.2">
        <h3 id="name-protocol-overview">
<a href="#section-1.2" class="section-number selfRef">1.2. </a><a href="#name-protocol-overview" class="section-name selfRef">Protocol Overview</a>
        </h3>
<p id="section-1.2-1">The issuance protocol defined in this document decouples sensitive information in the
attestation context, such as the client identity, from the information in the redemption
context, such as the origin. It does so by employing the 'Split Origin, Attester, Issuer'
model. In this model, the Issuer learns redemption information like origin identity (used
to determine per-origin rate limit policies), and the Attester learns attestation
information like client identity (used to keep track of the previous instances of token
issuance).<a href="#section-1.2-1" class="pilcrow">¶</a></p>
<p id="section-1.2-2"><a href="#fig-example-allow" class="auto internal xref">Figure 1</a> shows how this interaction works for client requests that
are within the rate limit. The Client's token request to the Attester (constructed
according to <a href="#request-one" class="auto internal xref">Section 5.3</a>, and forwarded to the Issuer according to <a href="#request-two" class="auto internal xref">Section 5.4</a>)
contains encrypted information that the Issuer uses to identify the relevant rate
limit policy to apply. This rate limit policy is returned to the Attester (according
to <a href="#response-one" class="auto internal xref">Section 5.5</a>), which then checks whether or not the Client is within this
policy. If yes, the Attester forwards the issuer token response to the Client
so that the resulting token can be redeemed by the Origin.<a href="#section-1.2-2" class="pilcrow">¶</a></p>
<span id="name-successful-rate-limited-iss"></span><div id="fig-example-allow">
<figure id="figure-1">
          <div class="alignLeft art-text artwork" id="section-1.2-3.1">
<pre>
                                                     +-----------+
      Client                                         |   Origin  |
        |                    Challenge               |           |
        &lt;-------------------------------------------------+      |
        |                                            |           |
        |          +-------------+                   |           |
        |          |   Attester  |                   |           |
        |          |             |                   |           |
        |          | Attest      |    +----------+   |           |
        +-----------------&gt;      |    |  Issuer  |   |           |
        |          |             |    |          |   |           |
        |   TokenRequest         |    |          |   |           |
        |   + Anon Origin ID     |    |          |   |           |
        | [ + Encrypted Origin ] |    |          |   |           |
        +-----------------&gt;      |    |          |   |           |
        |          |             |    |          |   |           |
        |          |       TokenRequest          |   |           |
        |          |      [ + Encrypted origin ] |   |           |
        |          |     +-------------------&gt;   |   |           |
        |          |             |    |          |   |           |
        |          |             |    |          |   |           |
        |          |       TokenResponse         |   |           |
        |          |      [ + Rate limit ]       |   |           |
        |          |     &lt;-------------------+   |   |           |
        |          |             |    |          |   |           |
        |          |  in limit?  |    |          |   |           |
        |          |     yes     |    |          |   |           |
        |          |             |    |          |   |           |
        |   TokenResponse        |    |          |   |           |
        &lt;-----------------+      |    |          |   |           |
        |          |             |    |          |   |           |
        |          +-------------+    +----------+   |           |
        |                                            |           |
        |                    Redeem                  |           |
        +-------------------------------------------------&gt;      |
                                                     |           |
                                                     +-----------+
</pre>
</div>
<figcaption><a href="#figure-1" class="selfRef">Figure 1</a>:
<a href="#name-successful-rate-limited-iss" class="selfRef">Successful rate-limited issuance</a>
          </figcaption></figure>
</div>
<p id="section-1.2-4"><a href="#fig-example-deny" class="auto internal xref">Figure 2</a> shows how this interaction works for client requests that
exceed the rate limit. The Client's request to the Issuer and the Issuer's
response to the Attester are the same. However, in this scenario, the Client
is not within the rate limit, so the Attester responds to the Client with an
error instead of the issuer's token response.<a href="#section-1.2-4" class="pilcrow">¶</a></p>
<span id="name-failed-rate-limited-issuanc"></span><div id="fig-example-deny">
<figure id="figure-2">
          <div class="alignLeft art-text artwork" id="section-1.2-5.1">
<pre>
                                                     +-----------+
      Client                                         |   Origin  |
        |                    Challenge               |           |
        &lt;-------------------------------------------------+      |
        |                                            |           |
        |          +-------------+                   |           |
        |          |   Attester  |                   |           |
        |          |             |                   |           |
        |          | Attest      |    +----------+   |           |
        +-----------------&gt;      |    |  Issuer  |   |           |
        |          |             |    |          |   |           |
        |   TokenRequest         |    |          |   |           |
        |   + Anon Origin ID     |    |          |   |           |
        | [ + Encrypted Origin ] |    |          |   |           |
        +-----------------&gt;      |    |          |   |           |
        |          |             |    |          |   |           |
        |          |       TokenRequest          |   |           |
        |          |      [ + Encrypted origin ] |   |           |
        |          |     +-------------------&gt;   |   |           |
        |          |             |    |          |   |           |
        |          |             |    |          |   |           |
        |          |       TokenResponse         |   |           |
        |          |       + Rate limit          |   |           |
        |          |     &lt;-------------------+   |   |           |
        |          |             |    |          |   |           |
        |          |  in limit?  |    |          |   |           |
        |          |      no     |    |          |   |           |
        |          |             |    |          |   |           |
        |        Error           |    |          |   |           |
        &lt;-----------------+      |    |          |   |           |
        |          |             |    |          |   |           |
        |          +-------------+    +----------+   |           |
        X                                            |           |
  issuance failed                                    +-----------+
</pre>
</div>
<figcaption><a href="#figure-2" class="selfRef">Figure 2</a>:
<a href="#name-failed-rate-limited-issuanc" class="selfRef">Failed rate-limited issuance</a>
          </figcaption></figure>
</div>
<p id="section-1.2-6">Each Issuer defines a window of time over which Attesters enforce rate limits,
defined in the Issuer configuration directory (<a href="#setup" class="auto internal xref">Section 3</a>). This window might
be as long as a month, or as short as an hour, depending on the use case. The
window is the same across all Origins that work with the Issuer; if multiple
window lengths are needed, then the entity running the Issuer can run multiple
Issuers with different Issuer names, one for each window length.<a href="#section-1.2-6" class="pilcrow">¶</a></p>
<p id="section-1.2-7">The window begins upon a Client's first token request to the Attester for that
Issuer and ends after the window time elapses, after which the Client's rate limit
state is reset. Issuers indicate which rate limit to use for a given request by
parsing the Client's encrypted Origin. Attesters enforce the rate limit based
on the value indicated by the Issuer, and maintaining the count of accesses
by a client to a corresponding Client's Origin Alias (see <a href="#terms" class="auto internal xref">Section 2</a>).<a href="#section-1.2-7" class="pilcrow">¶</a></p>
<p id="section-1.2-8">Along with the rate limit for the Origin, Issuers include a value generated
with a per-Origin secret in their responses, which allows Attesters to ensure
that the Client's Origin Alias indicated by the Client maps to exactly one Origin
as seen by the Issuer; this value that is used to validate the Client's Origin Alias
is called the Issuer's Origin Alias (see <a href="#terms" class="auto internal xref">Section 2</a>). Issuers can rotate the per-Origin secret
they use as desired. If a rotation event happens during a Client's active policy
window, the Attester would compute a different Issuer's Origin Alias and
mistakenly conclude that the Client is accessing a new Origin. To mitigate this,
Clients provide a stable Client's Origin Alias in their request to the Attester,
which is constant for all requests to that Origin. This allows the Attester to
detect when Issuer rotation events occur without affecting Client rate limits.<a href="#section-1.2-8" class="pilcrow">¶</a></p>
<span id="name-issuer-policy-window-rotati"></span><div id="fig-example-policy-windows">
<figure id="figure-3">
          <div class="alignLeft art-text artwork" id="section-1.2-9.1">
<pre>
                          Per-Origin
                         secret rotate
Issuer:      -----+------------X----------+------------&gt; Time
                  |         policy        |
Client            |         window        |
Token Requests:   *--------------*--------|
                  |              |        |
                  v              v        |
            Issuer Origin  Issuer Origin  |
                ID x           ID y       |
                  |                       |
            (policy start)          (policy end)
</pre>
</div>
<figcaption><a href="#figure-3" class="selfRef">Figure 3</a>:
<a href="#name-issuer-policy-window-rotati" class="selfRef">Issuer policy window rotation</a>
          </figcaption></figure>
</div>
<p id="section-1.2-10">Unlike the basic issuance protocol <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>, the rate-limited issuance protocol
in this document has additional functional and state requirements for Client, Attester,
and Issuer. <a href="#attester-state" class="auto internal xref">Section 5.1.2</a> describes the state that the Attester must track
in order to enforce these limits, <a href="#client-state" class="auto internal xref">Section 5.1.1</a> describes the Client state necessary
for successive token requests with the Attester, and <a href="#issuer-state" class="auto internal xref">Section 5.1.3</a> describes the state
necessary for the Issuer to apply rate limits. The functional description of each
participant in this protocol is explained in <a href="#issuance" class="auto internal xref">Section 5</a><a href="#section-1.2-10" class="pilcrow">¶</a></p>
</section>
</div>
<div id="properties">
<section id="section-1.3">
        <h3 id="name-properties-and-requirements">
<a href="#section-1.3" class="section-number selfRef">1.3. </a><a href="#name-properties-and-requirements" class="section-name selfRef">Properties and Requirements</a>
        </h3>
<p id="section-1.3-1">For rate-limited token issuance, the Attester, Issuer, and Origin as defined in
<span>[<a href="#ARCH" class="cite xref">ARCH</a>]</span> each have partial knowledge of the Client's identity and actions,
and each entity only knows enough to serve its function (see <a href="#terms" class="auto internal xref">Section 2</a> for more
about the pieces of information):<a href="#section-1.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1.3-2.1">
            <p id="section-1.3-2.1.1">The Attester knows the Client's identity and learns the Client's public key
(Client Key), the Issuer being targeted (Issuer Name), the period of time
for which the Issuer's policy is valid (Issuer Policy Window), the number of
tokens the Issuer is willing to issue within the current policy window, and the
number of tokens issued to a given Client for the claimed Origin in the policy
window. The Attester does not know the identity of the Origin the Client is
trying to access (Origin Name), but knows a Client-anonymized identifier for
it (Client's Origin Alias).<a href="#section-1.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.3-2.2">
            <p id="section-1.3-2.2.1">The Issuer knows a per-Origin secret (Issuer Origin Secret) and policy about client
access, and learns the Origin's identity (Origin Name) during issuance. The Issuer
does not learn the Client's identity or information about the Client's access
pattern.<a href="#section-1.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-1.3-2.3">
            <p id="section-1.3-2.3.1">The Origin knows the Issuer to which it will delegate an incoming Client
(Issuer Name), and can verify that any tokens presented by the Client were
signed by the Issuer. The Origin does not learn which Attester was used by a
Client for issuance.<a href="#section-1.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-1.3-3">Since an Issuer applies policies on behalf of Origins, a Client is required to
reveal the Origin's identity to the delegated Issuer. It is a requirement of
this protocol that the Attester not learn the Origin's identity so that,
despite knowing the Client's identity, an Attester cannot track and concentrate
information about Client activity.<a href="#section-1.3-3" class="pilcrow">¶</a></p>
<p id="section-1.3-4">An Issuer expects an Attester to verify its Clients' identities correctly, but an
Issuer cannot confirm an Attester's efficacy or the Attester-Client relationship
directly without learning the Client's identity. Similarly, an Origin does not
know the Attester's identity, but ultimately relies on the Attester to correctly
verify or authenticate a Client for the Origin's policies to be correctly
enforced. An Issuer therefore chooses to issue tokens to only known and
reputable Attesters; the Issuer can employ its own methods to determine the
reputation of a Attester.<a href="#section-1.3-4" class="pilcrow">¶</a></p>
<p id="section-1.3-5">An Attester is expected to employ a stable Client identifier, such as an IP
address, a device identifier, or an account at the Attester, that can serve as a
reasonable proxy for a user with some creation and maintenance cost on the user.<a href="#section-1.3-5" class="pilcrow">¶</a></p>
<p id="section-1.3-6">For the Issuance protocol, a Client is expected to create and maintain stable
and explicit secrets for time periods that are on the scale of Issuer policy
windows. Changing these secrets arbitrarily during a policy window can result in
token issuance failure for the rest of the policy window; see <a href="#client-state" class="auto internal xref">Section 5.1.1</a>
for more details. A Client can use a service offered by its Attester or a
third-party to store these secrets, but it is a requirement of this protocol
that the Attester not be able to learn these secrets.<a href="#section-1.3-6" class="pilcrow">¶</a></p>
<p id="section-1.3-7">The privacy guarantees of this issuance protocol, specifically those around
separating the identity of the Client from the names of the Origins that it
accesses, are based on the expectation that there is not collusion between
the entities that know about Client identity and those that know about Origin
identity. Clients choose and share information with Attesters, and Origins
choose and share policy with Issuers; however, the Attester is generally
expected to not be colluding with Issuers or Origins. If this occurs, it
can become possible for an Attester to learn or infer which Origins a
Client is accessing, or for an Origin to learn or infer the Client
identity. For further discussion, see <a href="#collusion" class="auto internal xref">Section 9.6</a>.<a href="#section-1.3-7" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terms">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">Unless otherwise specified, this document encodes protocol messages in TLS notation
from <span>[<a href="#TLS13" class="cite xref">TLS13</a>]</span>, Section 3.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This draft includes pseudocode that uses the functions and conventions defined
in <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">Encoding an integer to a sequence of bytes in network byte order is described
using the function "encode(n, v)", where "n" is the number of bytes and "v" is
the integer value. The function "len()" returns the length of a sequence of bytes.<a href="#section-2-4" class="pilcrow">¶</a></p>
<p id="section-2-5">The following terms are defined in <span>[<a href="#ARCH" class="cite xref">ARCH</a>]</span> and are used throughout this
document:<a href="#section-2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-6.1">
          <p id="section-2-6.1.1">Client: An entity that provides authorization tokens to services
across the Internet, in return for authorization.<a href="#section-2-6.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-6.2">
          <p id="section-2-6.2.1">Issuer: An entity that produces Privacy Pass tokens to clients.<a href="#section-2-6.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-6.3">
          <p id="section-2-6.3.1">Attester: An entity that can attest to properties about the client,
including previous patterns of access.<a href="#section-2-6.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-6.4">
          <p id="section-2-6.4.1">Origin: The server from which the client can redeem tokens.<a href="#section-2-6.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-6.5">
          <p id="section-2-6.5.1">Issuance Protocol: The protocol exchange that involves the client,
attester, and issuer, used to generate tokens.<a href="#section-2-6.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-7">The following terms are defined in <span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>, which defines the
interactions between clients and origins:<a href="#section-2-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-8.1">
          <p id="section-2-8.1.1">Issuer Name: The name that identifies the Issuer, which is an entity
that can generate tokens for a Client using one or more issuance protocols.<a href="#section-2-8.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-8.2">
          <p id="section-2-8.2.1">Token Key: Keying material that can be used with an issuance protocol
to create a signed token.<a href="#section-2-8.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-8.3">
          <p id="section-2-8.3.1">Origin Name: The name that identifies the Origin, as included in a
TokenChallenge.<a href="#section-2-8.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-2-9">Additionally, this document defines several terms that are unique to the
rate-limited issuance protocol:<a href="#section-2-9" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2-10.1">
          <p id="section-2-10.1.1">Issuer Policy Window: The period over which an Issuer will track access
policy, defined in terms of seconds and represented as a uint64. The state
that the Attester keeps for a Client is specific to a policy window.
The effective policy window for a specific Client starts when the Client
first sends a request associated with an Issuer.<a href="#section-2-10.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.2">
          <p id="section-2-10.2.1">Issuer Encapsulation Key: The public key used to encrypt values such as
Origin Name in requests from Clients to the Issuer, so that Attesters cannot learn
the Origin Name value. Each Issuer Encapsulation Key is used across all requests on the
Issuer, for different Origins.<a href="#section-2-10.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.3">
          <p id="section-2-10.3.1">Client's Origin Alias: An identifier that is generated by the Client and marked
on requests to the Attester, which represents a specific Origin anonymously. The Client
generates a stable Client's Origin Alias for each pair of Origin Name and Issuer Name,
to allow the Attester to count token access without learning the Origin Name.<a href="#section-2-10.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.4">
          <p id="section-2-10.4.1">Client Key: A public key chosen by the Client and shared only with the Attester;
see <a href="#issuance-unlinkability" class="auto internal xref">Section 8.4</a> for more details about this restriction.<a href="#section-2-10.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.5">
          <p id="section-2-10.5.1">Client Secret: The secret key used by the Client during token issuance, whose public key
(Client Key) is shared with the Attester.<a href="#section-2-10.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.6">
          <p id="section-2-10.6.1">Issuer Origin Secret: A per-origin secret key used by the Issuer during token issuance,
whose public key is not shared with anyone.<a href="#section-2-10.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-2-10.7">
          <p id="section-2-10.7.1">Issuer's Origin Alias: An identifier that is generated by Issuer based on an
Issuer Origin Secret that is per-Client and per-Origin. See <a href="#response-one" class="auto internal xref">Section 5.5</a> for details
of derivation.<a href="#section-2-10.7.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="setup">
<section id="section-3">
      <h2 id="name-configuration">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-configuration" class="section-name selfRef">Configuration</a>
      </h2>
<p id="section-3-1">Issuers MUST provide the following parameters for configuration:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">
          <p id="section-3-2.1.1">Issuer Policy Window: a uint64 of seconds as defined in <a href="#terms" class="auto internal xref">Section 2</a>.<a href="#section-3-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.2">
          <p id="section-3-2.2.1">Issuer Request URI: a token request URL for generating access tokens.
For example, an Issuer URL might be https://issuer.example.net/token-request. This parameter
uses resource media type "text/plain".<a href="#section-3-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.3">
          <p id="section-3-2.3.1">Issuer Public Key values: A list of Issuer Public Keys for the issuance protocol, each scoped to a particular origin.<a href="#section-3-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-3-2.4">
          <p id="section-3-2.4.1">Issuer Encapsulation Key: a <code>EncapsulationKey</code> structure as defined below to use when encapsulating
information, such as the origin name, to the Issuer in issuance requests. This parameter uses resource media type
"application/issuer-encap-key". The Npk parameter corresponding to the HpkeKdfId can be found in <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>.<a href="#section-3-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<div class="alignLeft art-text artwork" id="section-3-3">
<pre>
opaque HpkePublicKey[Npk]; // defined in RFC9180
uint16 HpkeKemId;          // defined in RFC9180
uint16 HpkeKdfId;          // defined in RFC9180
uint16 HpkeAeadId;         // defined in RFC9180

struct {
  uint8 key_id;
  HpkeKemId kem_id;
  HpkePublicKey public_key;
  HpkeKdfId kdf_id;
  HpkeAeadId aead_id;
} EncapsulationKey;
</pre><a href="#section-3-3" class="pilcrow">¶</a>
</div>
<p id="section-3-4">The Issuer parameters can be obtained from an Issuer via a directory object, which is a JSON
object whose field names and values are raw values and URLs for the parameters.<a href="#section-3-4" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
        <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
          <tr>
            <th class="text-left" rowspan="1" colspan="1">Field Name</th>
            <th class="text-left" rowspan="1" colspan="1">Value</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-policy-window</td>
            <td class="text-left" rowspan="1" colspan="1">Issuer Policy Window as a JSON number</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">issuer-request-uri</td>
            <td class="text-left" rowspan="1" colspan="1">Issuer Request URI resource URL as a JSON string</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">encap-keys</td>
            <td class="text-left" rowspan="1" colspan="1">List of Encapsulation Key values, each as a base64url encoded EncapsulationKey value</td>
          </tr>
          <tr>
            <td class="text-left" rowspan="1" colspan="1">token-keys</td>
            <td class="text-left" rowspan="1" colspan="1">List of Token Key values, each represented as JSON objects</td>
          </tr>
        </tbody>
      </table>
<p id="section-3-6">The "token-keys" JSON object is inherited from the basic issuance <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span> protocol,
with an additional key "origin", which is a JSON string that indicates which origin
is bound to the key.<a href="#section-3-6" class="pilcrow">¶</a></p>
<p id="section-3-7">Issuers MAY advertise multiple encap-keys to support key rotation, where the order
of the keys in the list indicates preference as with token-keys.<a href="#section-3-7" class="pilcrow">¶</a></p>
<p id="section-3-8">As an example, the Issuer's JSON directory could look like:<a href="#section-3-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3-9">
<pre>
 {
    "issuer-policy-window": 86400,
    "issuer-request-uri": "https://issuer.example.net/token-request",
    "encap-keys": [
      &lt;encoded EncapsulationKey&gt;
    ],
    "token-keys": [
      {
        "token-type": 3,
        "token-key": "MI...AB",
        "origin": "example.com"
      },
      {
        "token-type": 3,
        "token-key": "MI...AQ"
        "origin": "example.net"
      }
    ]
 }
</pre><a href="#section-3-9" class="pilcrow">¶</a>
</div>
<p id="section-3-10">Issuers MUST support at least one Token Key per origin. Issuers MAY support
multiple Token Key values for the same Origin in order to support rotation.<a href="#section-3-10" class="pilcrow">¶</a></p>
<p id="section-3-11">As in <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>, Issuer directory resources have the media type
"application/json" and are located at the well-known location
"/.well-known/token-issuer-directory".<a href="#section-3-11" class="pilcrow">¶</a></p>
</section>
</div>
<div id="token-challenge-requirements">
<section id="section-4">
      <h2 id="name-token-challenge-requirement">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-token-challenge-requirement" class="section-name selfRef">Token Challenge Requirements</a>
      </h2>
<p id="section-4-1">Clients receive challenges for tokens, as described in <span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">For the rate-limited token issuance protocol described in this document,
the name of the origin is sent in an encrypted message from the Client
to the Issuer. If the TokenChallenge.origin_info field contains a single
origin name, that origin name is used. If the origin_info field is empty, the
encrypted message is the empty string "". If the origin_info field contains
multiple origin names, the Client is permitted to select any of the origin
names to use for the encrypted message. In general, the Client SHOULD
select the origin name that presented the challenge. However, in the context
of loading a webpage, the Client SHOULD prefer using the name of the
main document URL (the first-party name, as opposed to a third-party name)
if it is present in the origin_info list. This allows a third-party (an
embedded website resource) to send a challenge that applies a rate-limit
to the first party name (the origin that hosts the main document URL).
If a third-party is sending challenges in this way (that contain both the
first- and third-party origin names), the Issuers need to ensure that they
only allow rate-limiting on the expected origin (which SHOULD be the
first-party name, to align with Client behavior).<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">The HTTP authentication challenge also SHOULD contain the following
additional attribute:<a href="#section-4-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-4.1">
          <p id="section-4-4.1.1">"issuer-encap-key", which contains a base64url encoding of a <code>EncapsulationKey</code> as defined
in <a href="#setup" class="auto internal xref">Section 3</a> to use when encrypting the Origin Name in issuance requests.<a href="#section-4-4.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
</section>
</div>
<div id="issuance">
<section id="section-5">
      <h2 id="name-issuance-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-issuance-protocol" class="section-name selfRef">Issuance Protocol</a>
      </h2>
<p id="section-5-1">This section describes the Issuance protocol for a Client to request and receive
a token from an Issuer. Token issuance involves a Client, Attester, and Issuer,
with the following steps:<a href="#section-5-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-5-2">
<li id="section-5-2.1">
          <p id="section-5-2.1.1">The Client sends a token request containing a token request, encrypted origin
name, and one-time-use public key and signature to the Attester<a href="#section-5-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.2">
          <p id="section-5-2.2.1">The Attester validates the request contents, specifically checking the request
signature, and proxies the request to the Issuer<a href="#section-5-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.3">
          <p id="section-5-2.3.1">The Issuer validates the request against the signature, and processes its contents,
and produces a token response sent back to the Attester<a href="#section-5-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-5-2.4">
          <p id="section-5-2.4.1">The Attester verifies the response and proxies the response to the Client<a href="#section-5-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ol>
<p id="section-5-3">The Issuance protocol is designed such that Client, Attester, and Issuer learn only
what is necessary for completing the protocol; see <a href="#info-disclosure" class="auto internal xref">Section 8.5</a> for more details.<a href="#section-5-3" class="pilcrow">¶</a></p>
<p id="section-5-4">The Issuance protocol has a number of underlying cryptographic dependencies for
operation:<a href="#section-5-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5-5.1">
          <p id="section-5-5.1.1">RSA Blind Signatures <span>[<a href="#BLINDSIG" class="cite xref">BLINDSIG</a>]</span>, for issuing and constructing Tokens. This support
is the same as used in the base publicly verifiable token issuance protocol <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span><a href="#section-5-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-5.2">
          <p id="section-5-5.2.1"><span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span>, for encrypting the origin server name in transit between Client and Issuer across the Attester.<a href="#section-5-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-5-5.3">
          <p id="section-5-5.3.1">Signatures with key blinding, as described in <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>, for verifying
correctness of Client requests.<a href="#section-5-5.3.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-5-6">Clients and Issuers are required to implement all of these dependencies, whereas Attesters are required
to implement signature with key blinding support.<a href="#section-5-6" class="pilcrow">¶</a></p>
<div id="state-requirements">
<section id="section-5.1">
        <h3 id="name-state-requirements">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-state-requirements" class="section-name selfRef">State Requirements</a>
        </h3>
<p id="section-5.1-1">The Issuance protocol requires each participating endpoint to maintain some
necessary state, as described in this section.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<div id="client-state">
<section id="section-5.1.1">
          <h4 id="name-client-state">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-client-state" class="section-name selfRef">Client State</a>
          </h4>
<p id="section-5.1.1-1">A Client is required to have the following information, derived from a given TokenChallenge:<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.1-2.1">
              <p id="section-5.1.1-2.1.1">Origin Name, a hostname referring to the Origin <span>[<a href="#RFC6454" class="cite xref">RFC6454</a>]</span>. This is the name
of the Origin that issued the token challenge. One or more names can be listed
in the TokenChallenge.origin_info field. Rate-limited token issuance relies on the
client selecting a single origin name from this list if multiple are present.<a href="#section-5.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.2">
              <p id="section-5.1.1-2.2.1">Token Key, a blind signature public key specific to the Origin. This key is owned by the
Issuer identified by the TokenChallenge.issuer_name.<a href="#section-5.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.1-2.3">
              <p id="section-5.1.1-2.3.1">Issuer Encapsulation Key, a public key used to encrypt request information corresponding
to the Issuer identified by TokenChallenge.issuer_name.<a href="#section-5.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.1-3">Clients maintain a stable Client Key that they use for all communication with
a specific Attester. Client Key is a public key, where the corresponding private key
Client Secret is known only to the client.<a href="#section-5.1.1-3" class="pilcrow">¶</a></p>
<p id="section-5.1.1-4">If the client loses this (Client Key, Client Secret), they may generate a new tuple. The
Attester will enforce if a client is allowed to use this new Client Key. See <a href="#attester-state" class="auto internal xref">Section 5.1.2</a>
for details on this enforcement.<a href="#section-5.1.1-4" class="pilcrow">¶</a></p>
<p id="section-5.1.1-5">Clients also need to be able to generate an Client's Origin Alias value that corresponds
to the pair of Origin Name and Issuer Name, to send in requests to the Attester.<a href="#section-5.1.1-5" class="pilcrow">¶</a></p>
<p id="section-5.1.1-6">Client's Origin Alias MUST be a stable and unpredictable 32-byte value computed by the Client.
Clients MUST NOT change this value across token requests for the same Origin Name and Issuer
Name. See <a href="#penalization" class="auto internal xref">Section 5.6</a> for a discussion of Attester behavior if a collision is detected.<a href="#section-5.1.1-6" class="pilcrow">¶</a></p>
<p id="section-5.1.1-7">One possible mechanism for implementing this identifier is for the Client to store a mapping
between the pair of (Origin Name, Issuer Name) and a randomly generated Client's Origin Alias
for future requests. Alternatively, the Client can compute a PRF keyed by a per-client secret
(Client Secret) over the Origin Name and Issuer Name, e.g.,
Client's Origin Alias = HKDF(secret=Client Secret, salt="", info=(Origin Name, Issuer name)).<a href="#section-5.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="attester-state">
<section id="section-5.1.2">
          <h4 id="name-attester-state">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-attester-state" class="section-name selfRef">Attester State</a>
          </h4>
<p id="section-5.1.2-1">An Attester is required to maintain state for every authenticated Client. The mechanism
of identifying a Client is specific to each Attester, and is not defined in this document.
As examples, the Attester could use device-specific certificates or account authentication
to identify a Client.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<p id="section-5.1.2-2">Attesters need to enforce that Clients don't change their Client Key frequently, to ensure Clients can't
regularly evade the per-client policy as seen by the issuer. Attesters MUST NOT allow Clients to
change their Client Key more than once within a policy window, or in the subsequent policy window
after a previous Client Key change. Changing the secret will reset the client's policy window and
thus can be used to exceed rate limits. One way to mitigate this is for the Attester to penalize clients that register new secrets
too frequently. Alternative schemes where the Attester stores the encrypted
(Client Key, Client Secret) tuple on behalf of the client are possible but not described here.<a href="#section-5.1.2-2" class="pilcrow">¶</a></p>
<p id="section-5.1.2-3">The Attester keeps track of Clients and Issuers that are not trusted, due to problems like
changing Client Keys frequently, etc, as penalized entities (see <a href="#penalization" class="auto internal xref">Section 5.6</a>).<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
<p id="section-5.1.2-4">Attesters are expected to know both the Issuer Policy Window and current Issuer Encapsulation Key
for any Issuer Name to which they allow access. This information can be retrieved using the
URIs defined in <a href="#setup" class="auto internal xref">Section 3</a>. The current Issuer Encapsulation Key value is used to check the value
of the issuer_encap_key_id in Client-generated requests (<a href="#request-one" class="auto internal xref">Section 5.3</a>) to reject requests where
clients are using unique key IDs. Such unique keys could indicate a key-targeting attack that
intends de-anonymize a client to the Issuer. In order to handle encapsulation key rotation, the Attester
needs to know the current key value and the previou key value, and remember the last time the
value changed to ensure that it does not happen too frequently (such as no more than once per
policy window, or no more than once per day).<a href="#section-5.1.2-4" class="pilcrow">¶</a></p>
<p id="section-5.1.2-5">For each Client-Issuer pair, an Attester maintains a policy window
start and end time for each Issuer from which a Client requests a token.<a href="#section-5.1.2-5" class="pilcrow">¶</a></p>
<p id="section-5.1.2-6">For each tuple of (Client Key, Client's Origin Alias, policy window), the Attester maintains the
following state:<a href="#section-5.1.2-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.1.2-7.1">
              <p id="section-5.1.2-7.1.1">A counter of successful tokens issued<a href="#section-5.1.2-7.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-7.2">
              <p id="section-5.1.2-7.2.1">Whether or not a previous request was rejected by the Issuer<a href="#section-5.1.2-7.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-7.3">
              <p id="section-5.1.2-7.3.1">The previous rate limit provided by the Issuer<a href="#section-5.1.2-7.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.1.2-7.4">
              <p id="section-5.1.2-7.4.1">The last received Issuer's Origin Alias value for this Client's Origin Alias, if any<a href="#section-5.1.2-7.4.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.1.2-8">The Issuer-provided rate limit for a single Origin is intended to not change more frequently
than once per policy window. If the Attester detects a change of rate limit multiple times
for the state kept for a single policy window, it SHOULD reject tokens issued in the remainder
of the policy window.<a href="#section-5.1.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuer-state">
<section id="section-5.1.3">
          <h4 id="name-issuer-state">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-issuer-state" class="section-name selfRef">Issuer State</a>
          </h4>
<p id="section-5.1.3-1">Issuers maintain a stable Issuer Origin Secret that they use in calculating values returned
to the Attester for each origin. If this value changes, it will open up a possibility
for Clients to request extra tokens for an Origin without being limited, within a
policy window. See <a href="#token-key-management" class="auto internal xref">Section 10.1</a> for details about generating and rotating
the Issuer Origin Secret.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<p id="section-5.1.3-2">Issuers are expected to have the private key that corresponds to Issuer Encapsulation Key,
which allows them to decrypt the Origin Name values in requests.<a href="#section-5.1.3-2" class="pilcrow">¶</a></p>
<p id="section-5.1.3-3">For each Origin, Issuers need to know what rate limit to enforce during a policy window.
Issuers SHOULD NOT use unique values for specific Origins, which would allow Attesters
to recognize an Origin being accessed by multiple Clients. Each Origin limit is allowed
to change, but SHOULD NOT change more often than once per policy window, to ensure that
the limit is useful.<a href="#section-5.1.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="issuance-http-headers">
<section id="section-5.2">
        <h3 id="name-issuance-http-headers">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-issuance-http-headers" class="section-name selfRef">Issuance HTTP Headers</a>
        </h3>
<p id="section-5.2-1">The Issuance protocol defines four new HTTP headers that are used in requests
and responses between Clients, Attesters, and Issuers (see <a href="#iana-headers" class="auto internal xref">Section 11.2</a>).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The "Sec-Token-Origin-Alias" is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent both on Client-to-Attester
requests (<a href="#request-one" class="auto internal xref">Section 5.3</a>) and on Issuer-to-Attester responses (<a href="#response-one" class="auto internal xref">Section 5.5</a>).
Its ABNF is:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-3">
<pre>
    Sec-Token-Origin-Alias = sf-binary
</pre><a href="#section-5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-5.2-4">The "Sec-Token-Client" is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Attester
requests (<a href="#request-one" class="auto internal xref">Section 5.3</a>), and contains the bytes of Client Key.
Its ABNF is:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-5">
<pre>
    Sec-Token-Client = sf-binary
</pre><a href="#section-5.2-5" class="pilcrow">¶</a>
</div>
<p id="section-5.2-6">The "Sec-Token-Request-Blind" is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its
value MUST be a Byte Sequence. This header is sent on Client-to-Attester
requests (<a href="#request-one" class="auto internal xref">Section 5.3</a>), and contains a per-request nonce value.
Its ABNF is:<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-7">
<pre>
    Sec-Token-Request-Blind = sf-binary
</pre><a href="#section-5.2-7" class="pilcrow">¶</a>
</div>
<p id="section-5.2-8">The "Sec-Token-Limit" is an Item Structured Header <span>[<a href="#RFC8941" class="cite xref">RFC8941</a>]</span>. Its
value MUST be an Integer. This header is sent on Issuer-to-Attester
responses (<a href="#response-one" class="auto internal xref">Section 5.5</a>), and contains the number of times a
Client can retrieve a token for the requested Origin within a policy window,
as set by the Issuer. Its ABNF is:<a href="#section-5.2-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2-9">
<pre>
    Sec-Token-Limit = sf-integer
</pre><a href="#section-5.2-9" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="request-one">
<section id="section-5.3">
        <h3 id="name-client-to-attester-request">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-client-to-attester-request" class="section-name selfRef">Client-to-Attester Request</a>
        </h3>
<p id="section-5.3-1">The Client and Attester MUST use a secure and Attester-authenticated HTTPS
connection. They MAY use mutual authentication or mechanisms such as TLS
certificate pinning, to mitigate the risk of channel compromise; see
<a href="#sec-considerations" class="auto internal xref">Section 8</a> for additional about this channel.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<div id="client-behavior">
<section id="section-5.3.1">
          <h4 id="name-client-behavior">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-client-behavior" class="section-name selfRef">Client behavior</a>
          </h4>
<p id="section-5.3.1-1">Requests to the Attester need to indicate the Issuer Name to which issuance
requests will be forwarded. Attesters SHOULD provide Clients with a URI template
that contains one variable that contains the Issuer Name, "issuer", using
Level 3 URI template encoding as defined in Section 1.2 of <span>[<a href="#RFC6570" class="cite xref">RFC6570</a>]</span>.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<p id="section-5.3.1-2">An example of an Attester URI templates is shown below:<a href="#section-5.3.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-3">
<pre>
https://attester.net/token-request{?issuer}
</pre><a href="#section-5.3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-4">Attesters and Clients MAY agree on other mechanisms to specify the Issuer Name
in requests.<a href="#section-5.3.1-4" class="pilcrow">¶</a></p>
<p id="section-5.3.1-5">The Client first creates an issuance request message for a random value <code>nonce</code>
using the input TokenChallenge <code>challenge</code> and the Issuer key identifier <code>key_id</code>
as follows:<a href="#section-5.3.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-6">
<pre>
nonce = random(32)
context = SHA256(challenge)
token_input = concat(0x0003, nonce, context, key_id)
blinded_msg, blind_inv = rsabssa_blind(pkI, token_input)
</pre><a href="#section-5.3.1-6" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-7">The Client then uses Client Key to generate its one-time-use request public
key <code>request_key</code> and blind <code>request_blind</code> as described in <a href="#client-issuers-origin-alias" class="auto internal xref">Section 7.1</a>.<a href="#section-5.3.1-7" class="pilcrow">¶</a></p>
<p id="section-5.3.1-8">The Client then computes <code>token_key_id</code> as the least significant byte of the Token Key
ID, where the Token Key ID is generated as SHA256(public_key) and public_key is a DER-encoded
SubjectPublicKeyInfo object carrying Token Key. The Client then constructs a InnerTokenRequest
value, denoted <code>origin_token_request</code>, combining <code>token_key_id</code>, <code>blinded_msg</code>, and a padded
representation of the origin name as follows:<a href="#section-5.3.1-8" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-9">
<pre>
struct {
  uint8_t token_key_id;
  uint8_t blinded_msg[Nk];
  uint8_t padded_origin_name&lt;0..2^16-1&gt;;
} InnerTokenRequest;
</pre><a href="#section-5.3.1-9" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-10">This structure is initialized and then encrypted using Issuer Encryption Key, producing
<code>encrypted_token_request</code>, as described in <a href="#encrypt-origin" class="auto internal xref">Section 6</a>.<a href="#section-5.3.1-10" class="pilcrow">¶</a></p>
<p id="section-5.3.1-11">Finally, the Client uses Client Secret to produce <code>request_signature</code>
as described in <a href="#index-proof" class="auto internal xref">Section 7.1.2</a>.<a href="#section-5.3.1-11" class="pilcrow">¶</a></p>
<p id="section-5.3.1-12">The Client then constructs a TokenRequest structure. This TokenRequest
structure is based on the publicly verifiable token issuance path in
<span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>, adding fields for the encrypted origin name and request signature.<a href="#section-5.3.1-12" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-13">
<pre>
struct {
   uint16_t token_type = 0x0003;
   uint8_t request_key[Npk];
   uint8_t issuer_encap_key_id[32];
   uint8_t encrypted_token_request&lt;1..2^16-1&gt;;
   uint8_t request_signature[Nsig];
} TokenRequest;
</pre><a href="#section-5.3.1-13" class="pilcrow">¶</a>
</div>
<p id="section-5.3.1-14">The structure fields are defined as follows:<a href="#section-5.3.1-14" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.3.1-15.1">
              <p id="section-5.3.1-15.1.1">"token_type" is a 2-octet integer, which matches the type in the challenge.<a href="#section-5.3.1-15.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-15.2">
              <p id="section-5.3.1-15.2.1">"request_key" is the request_key value generated above.<a href="#section-5.3.1-15.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-15.3">
              <p id="section-5.3.1-15.3.1">"issuer_encap_key_id" is a collision-resistant hash that identifies the Issuer
Encryption Key, generated as SHA256(EncapsulationKey).<a href="#section-5.3.1-15.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-15.4">
              <p id="section-5.3.1-15.4.1">"encrypted_token_request" is an encrypted structure that contains an InnerTokenRequest
value, calculated as described in <a href="#encrypt-origin" class="auto internal xref">Section 6</a>.<a href="#section-5.3.1-15.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.3.1-15.5">
              <p id="section-5.3.1-15.5.1">"request_signature" is computed as described in <a href="#index-proof" class="auto internal xref">Section 7.1.2</a>.<a href="#section-5.3.1-15.5.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.3.1-16">The Client then generates an HTTP POST request to send through the Attester to
the Issuer, with the TokenRequest as the body. The media type for this request
is "message/token-request". The Client includes the "Sec-Token-Origin-Alias" header,
whose value is Client's Origin Alias; the "Sec-Token-Client" header, whose value is
Client Key; and the "Sec-Token-Request-Blind" header, whose value is request_blind.
The Client sends this request to the Attester's proxy URI. An example request is
shown below, where the Issuer Name is "issuer.net" and the Attester URI template is
"https://attester.net/token-request{?issuer}"<a href="#section-5.3.1-16" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-17">
<pre>
:method = POST
:scheme = https
:authority = attester.net
:path = /token-request?issuer=issuer.net
accept = message/token-response
cache-control = no-cache, no-store
content-type = message/token-request
content-length = &lt;Length of TokenRequest&gt;
sec-token-origin-alias = Client's Origin Alias
sec-token-client = Client Key
sec-token-request-blind = request_blind

&lt;Bytes containing the TokenRequest&gt;
</pre><a href="#section-5.3.1-17" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="attester-behavior">
<section id="section-5.3.2">
          <h4 id="name-attester-behavior">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-attester-behavior" class="section-name selfRef">Attester behavior</a>
          </h4>
<p id="section-5.3.2-1">Upon receiving a request from a Client, the Attester checks if the Client has been
penalized based on incorrect behavior using this protocol (see <a href="#penalization" class="auto internal xref">Section 5.6</a>).
If the Client is not trusted, the Attester rejects the request with an appropriate HTTP 4xx error.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">If this Issuer for the token request is not known to or trusted by the Attester, including if the Issuer
has been penalized (see <a href="#penalization" class="auto internal xref">Section 5.6</a>), the Attester rejects the request with
an appropriate HTTP error.<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
<p id="section-5.3.2-3">If the Attester detects a token_type in the TokenRequest that it does not recognize
or support, it MUST reject the request with an HTTP 400 error.<a href="#section-5.3.2-3" class="pilcrow">¶</a></p>
<p id="section-5.3.2-4">The Attester also checks to validate that the issuer_encap_key_id in the client's TokenRequest
matches a known Issuer Encapsulation Key public key for the Issuer. For example, the Attester can
fetch this key using the API defined in <a href="#setup" class="auto internal xref">Section 3</a>. This check is done to help ensure that
the Client has not been given a unique key that could allow the Issuer to fingerprint or target
the Client. If the key does not match, the Attester rejects the request with an HTTP
400 error. Note that this can lead to failures in the event of Issuer Issuer Encapsulation Key
rotation; see <a href="#privacy-considerations" class="auto internal xref">Section 9</a> for considerations.<a href="#section-5.3.2-4" class="pilcrow">¶</a></p>
<p id="section-5.3.2-5">The Attester finally validates the Client's stable mapping request as described in
<a href="#attester-issuers-origin-alias" class="auto internal xref">Section 7.2</a>. If this fails, the Attester MUST return an HTTP 400
error to the Client.<a href="#section-5.3.2-5" class="pilcrow">¶</a></p>
<p id="section-5.3.2-6">If the Attester accepts the request, it will look up the state stored for this Client.
It will look up the count of previously generate tokens for this Client using the same
Client's Origin Alias. See <a href="#attester-state" class="auto internal xref">Section 5.1.2</a> for more details.<a href="#section-5.3.2-6" class="pilcrow">¶</a></p>
<p id="section-5.3.2-7">If the Attester has stored state that a previous request for this Client's Origin Alias was
rejected by the Issuer in the current policy window, it SHOULD reject the request without
forwarding it to the Issuer.<a href="#section-5.3.2-7" class="pilcrow">¶</a></p>
<p id="section-5.3.2-8">If the Attester detects this Client has changed their Client Key more frequently than allowed
as described in <a href="#attester-state" class="auto internal xref">Section 5.1.2</a>, it SHOULD reject the request without forwarding it to
the Issuer, and also use this event to penalize the Client (see <a href="#penalization" class="auto internal xref">Section 5.6</a>).<a href="#section-5.3.2-8" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="request-two">
<section id="section-5.4">
        <h3 id="name-attester-to-issuer-request">
<a href="#section-5.4" class="section-number selfRef">5.4. </a><a href="#name-attester-to-issuer-request" class="section-name selfRef">Attester-to-Issuer Request</a>
        </h3>
<p id="section-5.4-1">The Attester and the Issuer MUST use a secure and Issuer-authenticated HTTPS
connection for all requests. Also, Issuers MUST authenticate Attesters, either via mutual
TLS or another form of application-layer authentication. They MAY additionally use
mechanisms such as TLS certificate pinning, to mitigate the risk of channel
compromise; see <a href="#sec-considerations" class="auto internal xref">Section 8</a> for additional about this channel.<a href="#section-5.4-1" class="pilcrow">¶</a></p>
<div id="attester-behavior-1">
<section id="section-5.4.1">
          <h4 id="name-attester-behavior-2">
<a href="#section-5.4.1" class="section-number selfRef">5.4.1. </a><a href="#name-attester-behavior-2" class="section-name selfRef">Attester behavior</a>
          </h4>
<p id="section-5.4.1-1">Assuming all checks in <a href="#request-one" class="auto internal xref">Section 5.3</a> succeed, the Attester generates an HTTP POST request
to send to the Issuer with the Client's TokenRequest as the body. The Attester MUST NOT
add information that will uniquely identify a Client, or associate the request with a small
set of possible Clients. Extensions to this protocol MAY allow Attesters to add information
that can be used to separate large populations, such as providing information about the country
or region to which a Client belongs. An example request is shown below.<a href="#section-5.4.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.4.1-2">
<pre>
:method = POST
:scheme = https
:authority = issuer.net
:path = /token-request
accept = message/token-response
cache-control = no-cache, no-store
content-type = message/token-request
content-length = &lt;Length of TokenRequest&gt;

&lt;Bytes containing the TokenRequest&gt;
</pre><a href="#section-5.4.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="issuer-behavior">
<section id="section-5.4.2">
          <h4 id="name-issuer-behavior">
<a href="#section-5.4.2" class="section-number selfRef">5.4.2. </a><a href="#name-issuer-behavior" class="section-name selfRef">Issuer behavior</a>
          </h4>
<p id="section-5.4.2-1">Upon receipt of the forwarded request, the Issuer validates the following conditions:<a href="#section-5.4.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.4.2-2.1">
              <p id="section-5.4.2-2.1.1">The TokenRequest contains a supported token_type<a href="#section-5.4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.2">
              <p id="section-5.4.2-2.2.1">The TokenRequest.issuer_encap_key_id correspond to known Issuer Encapsulation Keys held by the Issuer.<a href="#section-5.4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-5.4.2-2.3">
              <p id="section-5.4.2-2.3.1">The TokenRequest.encrypted_token_request can be decrypted using the
Issuer's private key (the private key associated with Issuer Encapsulation Key), and contains
a valid InnerTokenRequest whose unpadded origin name matches an Origin Name that is served by
the Issuer. The Origin name associated with the InnerTokenRequest value might be the empty string "",
as described in <a href="#encrypt-origin" class="auto internal xref">Section 6</a>, in which case the Issuer applies a cross-origin
policy if supported. If a cross-origin policy is not supported, this condition is not met.<a href="#section-5.4.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ul>
<p id="section-5.4.2-3">If any of these conditions is not met, the Issuer MUST return an HTTP 400 error to the Attester,
which will forward the error to the client.<a href="#section-5.4.2-3" class="pilcrow">¶</a></p>
<p id="section-5.4.2-4">The Issuer determines the correct Issuer Key by using the decrypted Origin Name and
InnerTokenRequest.token_key_id values. If there is no Token Key whose truncated key ID matches
InnerTokenRequest.token_key_id, the Issuer MUST return an HTTP 401 error to Attester, which will
forward the error to the client. The Attester learns that the client's view of the Origin key
was invalid in the process.<a href="#section-5.4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="response-one">
<section id="section-5.5">
        <h3 id="name-token-issuance-response">
<a href="#section-5.5" class="section-number selfRef">5.5. </a><a href="#name-token-issuance-response" class="section-name selfRef">Token Issuance Response</a>
        </h3>
<div id="issuer-behavior-1">
<section id="section-5.5.1">
          <h4 id="name-issuer-behavior-2">
<a href="#section-5.5.1" class="section-number selfRef">5.5.1. </a><a href="#name-issuer-behavior-2" class="section-name selfRef">Issuer behavior</a>
          </h4>
<p id="section-5.5.1-1">If the Issuer is willing to give a token to the Client, the Issuer decrypts
TokenRequest.encrypted_token_request to discover a InnerTokenRequest value. If this fails,
the Issuer rejects the request with a 400 error. Otherwise, the Issuer validates and
processes the token request with Issuer Origin Secret corresponding to the designated
Origin as described in <a href="#issuer-issuers-origin-alias" class="auto internal xref">Section 7.3</a>. If this fails, the Issuer
rejects the request with a 400 error. Otherwise, the output is
index_key.<a href="#section-5.5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.5.1-2">The Issuer completes the issuance flow by computing a blinded response as follows:<a href="#section-5.5.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.1-3">
<pre>
blind_sig = rsabssa_blind_sign(skP, InnerTokenRequest.blinded_msg)
</pre><a href="#section-5.5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-5.5.1-4"><code>skP</code> is the private key corresponding to the per-Origin Token Key, known only to the Issuer.
The Issuer then encrypts <code>blind_sig</code> to the Client as described in <a href="#encap-issuer-to-client" class="auto internal xref">Section 6.2</a>,
yielding <code>encrypted_token_response</code>.<a href="#section-5.5.1-4" class="pilcrow">¶</a></p>
<p id="section-5.5.1-5">The Issuer generates an HTTP response with status code 200 whose body consists of
blind_sig, with the content type set as "message/token-response", the
index_key set in the "Sec-Token-Origin-Alias" header, and the limit of tokens
allowed for a Client for the Origin within a policy window set in the
"Sec-Token-Limit" header. This limit SHOULD NOT be unique to a specific
Origin, such that the Attester could use the value to infer which Origin
the Client is accessing (see <a href="#privacy-considerations" class="auto internal xref">Section 9</a>).<a href="#section-5.5.1-5" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.1-6">
<pre>
:status = 200
content-type = message/token-response
content-length = &lt;Length of blind_sig&gt;
sec-token-origin-alias = index_key
sec-token-limit = Token limit

&lt;Bytes containing the encrypted_token_response&gt;
</pre><a href="#section-5.5.1-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="attester-behavior-2">
<section id="section-5.5.2">
          <h4 id="name-attester-behavior-3">
<a href="#section-5.5.2" class="section-number selfRef">5.5.2. </a><a href="#name-attester-behavior-3" class="section-name selfRef">Attester behavior</a>
          </h4>
<p id="section-5.5.2-1">For all non-successful responses from the Issuer, the Attester forwards the HTTP
response unmodified to the Client as the response to the original request for this issuance.<a href="#section-5.5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.5.2-2">Upon receipt of a successful (2xx) response from the Issuer, the Attester extracts the
"Sec-Token-Origin-Alias" header, and uses the value to determine Issuer's Origin Alias
as described in <a href="#attester-output-issuers-origin-alias" class="auto internal xref">Section 7.4</a>.<a href="#section-5.5.2-2" class="pilcrow">¶</a></p>
<p id="section-5.5.2-3">If the "Sec-Token-Origin-Alias" header is missing in a successful (2xx) response from the
Issuer, the Attester MUST count this towards penalizing the Issuer (see <a href="#penalization" class="auto internal xref">Section 5.6</a>).
The token response MUST continue to be processed, however, to prevent a malicious
Issuer from using a token issuance failure as a signal to the requesting Origin.<a href="#section-5.5.2-3" class="pilcrow">¶</a></p>
<p id="section-5.5.2-4">If the Issuer's Origin Alias derived from the value in the "Sec-Token-Origin-Alias" header
was previously received in a response for a request with a different Client's Origin Alias within the
same policy window, the Attester MUST count this towards penalizing the Issuer or
Client (see <a href="#penalization" class="auto internal xref">Section 5.6</a>). The token response MUST continue to be processed, however,
to prevent a malicious Issuer from using a token issuance failure as a signal to the
requesting Origin.<a href="#section-5.5.2-4" class="pilcrow">¶</a></p>
<p id="section-5.5.2-5">The Attester then stores the Issuer's Origin Alias alongside the state for the Anonymous
Origin ID to compare on future token issuances.<a href="#section-5.5.2-5" class="pilcrow">¶</a></p>
<p id="section-5.5.2-6">The Attester also extracts the "Sec-Token-Limit" header, and compares the limit against the
previous count of accesses for this Client for the Client's Origin Alias. If the count is greater
than or equal to the limit, the Attester drops the token and responds to the client with an
HTTP 429 (Too Many Requests) error.<a href="#section-5.5.2-6" class="pilcrow">¶</a></p>
<p id="section-5.5.2-7">When the Attester detects successful token issuance, it MUST increment the counter
in its state for the number of tokens issued to the Client for the Client's Origin Alias.<a href="#section-5.5.2-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-behavior-1">
<section id="section-5.5.3">
          <h4 id="name-client-behavior-2">
<a href="#section-5.5.3" class="section-number selfRef">5.5.3. </a><a href="#name-client-behavior-2" class="section-name selfRef">Client behavior</a>
          </h4>
<p id="section-5.5.3-1">Upon receipt, the Client decrypts the <code>blind_sig</code> from <code>encrypted_token_response</code> as
described in <a href="#encap-issuer-to-client" class="auto internal xref">Section 6.2</a>. If successful, the Client then processes
the response as follows:<a href="#section-5.5.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.3-2">
<pre>
authenticator = rsabssa_finalize(pkI, token_input, blind_sig, blind_inv)
</pre><a href="#section-5.5.3-2" class="pilcrow">¶</a>
</div>
<p id="section-5.5.3-3">If this succeeds, the Client then constructs a token as described in
<span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span> as follows:<a href="#section-5.5.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.5.3-4">
<pre>
struct {
    uint16_t token_type = 0x0003
    uint8_t nonce[32];
    uint8_t context[32];
    uint8_t token_key_id[Nid];
    uint8_t authenticator[Nk]
} Token;
</pre><a href="#section-5.5.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="penalization">
<section id="section-5.6">
        <h3 id="name-penalization-of-invalid-cli">
<a href="#section-5.6" class="section-number selfRef">5.6. </a><a href="#name-penalization-of-invalid-cli" class="section-name selfRef">Penalization of Invalid Clients and Issuers</a>
        </h3>
<p id="section-5.6-1">When an Attester encounters incorrect and potentially malicious behavior
by either Clients or Issuers, it needs to "penalize" them. This involves
keeping state about invalid protocol events, and determining when a
particular Client or Issuer has exceeded a threshold for such events.<a href="#section-5.6-1" class="pilcrow">¶</a></p>
<p id="section-5.6-2">Each category of invalid events can have a different threshold, and can apply
to Clients, Issuers, or both. Different penalization events are described
below, with suggested thresholds. This list is not exhaustive.<a href="#section-5.6-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.6-3.1">
            <p id="section-5.6-3.1.1">Client Key changing more than once over any two consecutive policy windows
for a single Client, based on the Attester's view of Client identity.
This is a Client-specific penalization event. A RECOMMENDED threshold for
penalizing the Client based on this is one event; a well-behaved
Client will never change keys this frequently.<a href="#section-5.6-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.6-3.2">
            <p id="section-5.6-3.2.1">Issuer responses missing the "Sec-Token-Origin-Alias" header on a 2xx response.
This is an Issuer-specific penalization event. A RECOMMENDED threshold for
penalizing the Issuer based on this is ten events across all Clients; a
well-behaved Issuer will never generate such responses, but it can be
useful for an Attester to have a small tolerance for errors before penalizing
an Issuer entirely.<a href="#section-5.6-3.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.6-3.3">
            <p id="section-5.6-3.3.1">Issuer's Origin Alias (from Issuer) collision across two Anonymous
Origin IDs for a particular Client within a single policy window. This
penalization event is applicable for both Clients and Issuers. A RECOMMENDED
threshold for penalizing the Issuer is ten events across different Clients.
A RECOMMENDED threshold for penalizing the Client is two events across multiple
Issuers, or five events with a single Issuer. If many events are seen for a single
Issuer, it is likely that the Issuer is compromised or malicious; while if such events
are seen for a specific Client, it is likely that the Client is is compromised or
malicious.<a href="#section-5.6-3.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.6-4">Once a Client or Issuer passes the threshold for penalization, the Attester
rejects future requests from that Client or for that Issuer. This SHOULD
only be reset after a sufficient period of time (such as at least one policy
window), and based on either manual review or another validation process
determined by the Attester. Penalization indicates that a Client or Issuer
might be malicious or compromised, and so ought not to be trusted until
further validation that the error or attack has been mitigated.<a href="#section-5.6-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="encrypt-origin">
<section id="section-6">
      <h2 id="name-encrypting-origin-token-req">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-encrypting-origin-token-req" class="section-name selfRef">Encrypting Origin Token Requests and Responses</a>
      </h2>
<p id="section-6-1">Clients encapsulate token request information to the Issuer using the Issuer Encapsulation Key.
Issuers decrypt the token request using their corresponding private key. This process yields
the decrypted token request as well as a shared encryption context between Client and Issuer.
Issuers encapsulate their token response to the Client using an ephemeral key derived from this
shared encryption context. This process ensures that the Attester learns neither the token
request or response information.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">Client to Issuer encapsulation is described in <a href="#encap-client-to-issuer" class="auto internal xref">Section 6.1</a>, and Issuer to
Client encapsulation is described in <a href="#encap-issuer-to-client" class="auto internal xref">Section 6.2</a>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="encap-client-to-issuer">
<section id="section-6.1">
        <h3 id="name-client-to-issuer-encapsulat">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-client-to-issuer-encapsulat" class="section-name selfRef">Client to Issuer Encapsulation</a>
        </h3>
<p id="section-6.1-1">Given a <code>EncapsulationKey</code> (Issuer Encapsulation Key), Clients produce encrypted_token_request
using the following values:<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.1-2.1">
            <p id="section-6.1-2.1.1">the one octet key identifier from the Name Key, keyID, with the corresponding KEM identified by kemID,
the public key from the configuration, pkI, and;<a href="#section-6.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-6.1-2.2">
            <p id="section-6.1-2.2.1">a selected combination of KDF, identified by kdfID, and AEAD, identified by aeadID.<a href="#section-6.1-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-6.1-3">Beyond the key configuration inputs, Clients also require the following inputs defined
in <a href="#request-one" class="auto internal xref">Section 5.3</a>: <code>token_key_id</code>, <code>blinded_msg</code>, <code>request_key</code>, <code>origin_name</code>, and
<code>issuer_encap_key_id</code>.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
<p id="section-6.1-4">Together, these are used to encapsulate an InnerTokenRequest and produce an encrypted token
request (<code>encrypted_token_request</code>).<a href="#section-6.1-4" class="pilcrow">¶</a></p>
<p id="section-6.1-5"><code>origin_name</code> contains the name of the origin that initiated the challenge, as
taken from the TokenChallenge.origin_info field. If the TokenChallenge.origin_info field
is empty, <code>origin_name</code> is set to the empty string "".<a href="#section-6.1-5" class="pilcrow">¶</a></p>
<p id="section-6.1-6">The process for generating <code>encrypted_token_request</code> from <code>blinded_msg</code>, <code>request_key</code>, and
<code>origin_name</code> values is as follows:<a href="#section-6.1-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.1-7">
<li id="section-6.1-7.1">
            <p id="section-6.1-7.1.1">Compute an <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> context using pkI, yielding context and encapsulation key enc.<a href="#section-6.1-7.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-7.2">
            <p id="section-6.1-7.2.1">Construct associated data, aad, by concatenating the values of keyID, kemID, kdfID,
aeadID, and all other values of the TokenRequest structure.<a href="#section-6.1-7.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-7.3">
            <p id="section-6.1-7.3.1">Pad origin_name with N zero bytes, where N = 31 - ((L - 1) % 32) and L is the length
of origin_name. If L is 0, N = 32. Denote this padding process as the function <code>pad</code>.<a href="#section-6.1-7.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-7.4">
            <p id="section-6.1-7.4.1">Encrypt (seal) the padded origin_name with aad as associated data using context, yielding ciphertext ct.<a href="#section-6.1-7.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.1-7.5">
            <p id="section-6.1-7.5.1">Concatenate the values of aad, enc, and ct, yielding encrypted_token_request.<a href="#section-6.1-7.5.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.1-8">Note that enc is of fixed-length, so there is no ambiguity in parsing this structure.<a href="#section-6.1-8" class="pilcrow">¶</a></p>
<p id="section-6.1-9">In pseudocode, this procedure is as follows:<a href="#section-6.1-9" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-10">
<pre>
enc, context = SetupBaseS(pkI, "InnerTokenRequest")
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(2, token_type),
             encode(Npk, request_key),
             encode(32, issuer_encap_key_id))
padded_origin_name = pad(origin_name)
inner_token_request_enc = concat(encode(1, token_key_id),
                                 encode(Nk, blinded_msg),
                                 encode(2, len(padded_origin_name)),
                                 encode(len(padded_origin_name), padded_origin_name))
ct = context.Seal(aad, inner_token_request_enc)
encrypted_token_request = concat(enc, ct)
</pre><a href="#section-6.1-10" class="pilcrow">¶</a>
</div>
<p id="section-6.1-11">Issuers reverse this procedure to recover the InnerTokenRequest value by computing the AAD as
described above and decrypting encrypted_token_request with their private key skI (the private
key corresponding to pkI). The <code>origin_name</code> value is recovered from InnerTokenRequest.padded_origin_name
by stripping off padding bytes. In pseudocode, this procedure is as follows:<a href="#section-6.1-11" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1-12">
<pre>
enc, ct = parse(encrypted_token_request)
aad = concat(encode(1, keyID),
             encode(2, kemID),
             encode(2, kdfID),
             encode(2, aeadID),
             encode(2, token_type),
             encode(Npk, request_key),
             encode(32, issuer_encap_key_id))
context = SetupBaseR(enc, skI, "TokenRequest")
inner_token_request_enc, error = context.Open(aad, ct)
</pre><a href="#section-6.1-12" class="pilcrow">¶</a>
</div>
<p id="section-6.1-13">The <code>InnerTokenRequest.blinded_msg</code>, <code>InnerTokenRequest.token_key_id</code>, and unpadded <code>origin_name</code>
values are used by the Issuer as described in <a href="#request-two" class="auto internal xref">Section 5.4</a>.<a href="#section-6.1-13" class="pilcrow">¶</a></p>
</section>
</div>
<div id="encap-issuer-to-client">
<section id="section-6.2">
        <h3 id="name-issuer-to-client-encapsulat">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-issuer-to-client-encapsulat" class="section-name selfRef">Issuer to Client Encapsulation</a>
        </h3>
<p id="section-6.2-1">Given an HPKE context <code>context</code> computed in <a href="#encap-client-to-issuer" class="auto internal xref">Section 6.1</a>, Issuers encapsulate
their token response <code>blind_sig</code>, yielding an encrypted token response <code>encrypted_token_response</code>,
to the Client as follows:<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-6.2-2">
<li id="section-6.2-2.1">
            <p id="section-6.2-2.1.1">Export a secret <code>secret</code> from <code>context</code>, using the string "OriginTokenResponse" as context.
The length of this secret is <code>max(Nn, Nk)</code>, where <code>Nn</code> and <code>Nk</code> are the length of AEAD
key and nonce associated with <code>context</code>.<a href="#section-6.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.2">
            <p id="section-6.2-2.2.1">Generate a random value of length <code>max(Nn, Nk)</code> bytes, called <code>response_nonce</code>.<a href="#section-6.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.3">
            <p id="section-6.2-2.3.1">Extract a pseudorandom key <code>prk</code> using the <code>Extract</code> function provided by
the KDF algorithm associated with <code>context</code>. The <code>ikm</code> input to this
function is <code>secret</code>; the <code>salt</code> input is the concatenation of <code>enc</code> (from
<code>enc_request</code>) and <code>response_nonce</code><a href="#section-6.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.4">
            <p id="section-6.2-2.4.1">Use the <code>Expand</code> function provided by the same KDF to extract an AEAD key
<code>key</code>, of length <code>Nk</code> - the length of the keys used by the AEAD associated
with <code>context</code>. Generating <code>key</code> uses a label of "key".<a href="#section-6.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.5">
            <p id="section-6.2-2.5.1">Use the same <code>Expand</code> function to extract a nonce <code>nonce</code> of length <code>Nn</code> -
the length of the nonce used by the AEAD. Generating <code>nonce</code> uses a label of
"nonce".<a href="#section-6.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.6">
            <p id="section-6.2-2.6.1">Encrypt <code>blind_sig</code>, passing the AEAD function Seal the values of <code>key</code>,
<code>nonce</code>, empty <code>aad</code>, and a <code>pt</code> input of <code>request</code>, which yields <code>ct</code>.<a href="#section-6.2-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-6.2-2.7">
            <p id="section-6.2-2.7.1">Concatenate <code>response_nonce</code> and <code>ct</code>, yielding an Encapsulated Response
<code>enc_response</code>. Note that <code>response_nonce</code> is of fixed-length, so there is no
ambiguity in parsing either <code>response_nonce</code> or <code>ct</code>.<a href="#section-6.2-2.7.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-6.2-3">In pseudocode, this procedure is as follows:<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2-4">
<pre>
secret = context.Export("OriginTokenResponse", Nk)
response_nonce = random(max(Nn, Nk))
salt = concat(enc, response_nonce)
prk = Extract(salt, secret)
aead_key = Expand(prk, "key", Nk)
aead_nonce = Expand(prk, "nonce", Nn)
ct = Seal(aead_key, aead_nonce, "", blind_sig)
encrypted_token_response = concat(response_nonce, ct)
</pre><a href="#section-6.2-4" class="pilcrow">¶</a>
</div>
<p id="section-6.2-5">Clients decrypt <code>encrypted_token_response</code> by reversing this process. That is,
they first parse <code>enc_response</code> into <code>response_nonce</code> and <code>ct</code>. They then
follow the same process to derive values for <code>aead_key</code> and <code>aead_nonce</code>.<a href="#section-6.2-5" class="pilcrow">¶</a></p>
<p id="section-6.2-6">The client uses these values to decrypt <code>ct</code> using the Open function provided by
the AEAD. Decrypting might produce an error, as follows:<a href="#section-6.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2-7">
<pre>
blind_sig, error = Open(aead_key, aead_nonce, "", ct)
</pre><a href="#section-6.2-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="issuers-origin-alias">
<section id="section-7">
      <h2 id="name-issuers-origin-alias-comput">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-issuers-origin-alias-comput" class="section-name selfRef">Issuer's Origin Alias Computation</a>
      </h2>
<p id="section-7-1">This section describes the Client, Attester, and Issuer behavior in computing
Issuer's Origin Alias, the stable mapping based on client identity and
origin name. At a high level, this functionality computes y = F(x, k), where x
is a per-Client secret and k is a per-Origin secret, subject to the following constraints:<a href="#section-7-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-2.1">
          <p id="section-7-2.1.1">The Attester only learns y if the Client in possession of x engages with the protocol;<a href="#section-7-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.2">
          <p id="section-7-2.2.1">The Attester prevents a Client with private input x from running the protocol for input x' that is not equal to x;<a href="#section-7-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.3">
          <p id="section-7-2.3.1">The Issuer does not learn x, nor does it learn when two requests correspond to the same private value x; and<a href="#section-7-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-2.4">
          <p id="section-7-2.4.1">Neither the Client nor Attester learn k.<a href="#section-7-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-3">The interaction between Client, Attester, and Issuer in computing this
functionality is shown below.<a href="#section-7-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7-4">
<pre>
Client               Attester                Issuer
    (request, signature)
  ----------------------&gt;
                           (request, signature)
                         ----------------------&gt;
                                (response)
                         &lt;----------------------
</pre><a href="#section-7-4" class="pilcrow">¶</a>
</div>
<p id="section-7-5">The protocol for computing this functionality is divided into sections for
each of the participants. <a href="#client-issuers-origin-alias" class="auto internal xref">Section 7.1</a> describes Client behavior
for initiating the computation with its per-Client secret, <a href="#attester-issuers-origin-alias" class="auto internal xref">Section 7.2</a>
describes Attester behavior for verifying Client requests, <a href="#issuer-issuers-origin-alias" class="auto internal xref">Section 7.3</a>
describes Issuer behavior for computing the mapping with its per-Origin secret,
and <a href="#attester-output-issuers-origin-alias" class="auto internal xref">Section 7.4</a> describes the final Attester step for
computing the client-origin index.<a href="#section-7-5" class="pilcrow">¶</a></p>
<p id="section-7-6">The index computation is based on a signature scheme with key blinding and unblinding
support, denoted BKS, as described in <span><a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-signature-key-blinding-04#section-3" class="relref">Section 3</a> of [<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>. Such a scheme has the
following functions:<a href="#section-7-6" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-7.1">
          <p id="section-7-7.1.1">BKS-KeyGen(): Generate a random private and public key pair (sk, pk).<a href="#section-7-7.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.2">
          <p id="section-7-7.2.1">BKS-BlindKeyGen(): Generate a random blinding key bk.<a href="#section-7-7.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.3">
          <p id="section-7-7.3.1">BKS-BlindPublicKey(pk, bk, ctx): Produce a blinded public key based on the input public
key pk, blind key bk, and context ctx.<a href="#section-7-7.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.4">
          <p id="section-7-7.4.1">BKS-UnblindPublicKey(pk, bk, ctx): Produce an unblinded public key based on the input
blinded public key pk, blind bk, and context ctx.<a href="#section-7-7.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.5">
          <p id="section-7-7.5.1">BKS-Verify(pk, msg, sig): Verify signature sig over input message msg against the
public key pk, producing a boolean value indicating success.<a href="#section-7-7.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.6">
          <p id="section-7-7.6.1">BKS-BlindKeySign(sk_sign, sk_blind, ctx, msg): Sign input message msg with signing key sk_sign, blind
key sk_blind, and context ctx and produce a signature of size <code>Nsig</code> bytes.<a href="#section-7-7.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.7">
          <p id="section-7-7.7.1">BKS-SerializePrivatekey(sk): Serialize a private key to a byte string of length <code>Nsk</code>.<a href="#section-7-7.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.8">
          <p id="section-7-7.8.1">BKS-DeserializePrivatekey(buf): Attempt to deserialize a private key from an <code>Nsk</code>-byte
string buf. This function can fail if buf does not represent a valid private key.<a href="#section-7-7.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.9">
          <p id="section-7-7.9.1">BKS-SerializePublicKey(pk): Serialize a public key to a byte string of length <code>Npk</code>.<a href="#section-7-7.9.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-7.10">
          <p id="section-7-7.10.1">BKS-DeserializePublicKey(buf): Attempt to deserialize a public key of length <code>Npk</code>.
This function can fail if buf does not represent a valid public key.<a href="#section-7-7.10.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-8">Additionally, each BKS scheme has a corresponding hash function, denoted <code>Hash</code>.
The implementation of each of these functions depends on the issuance protocol
token type. See <a href="#iana-token-type" class="auto internal xref">Section 11.1</a> for more details.<a href="#section-7-8" class="pilcrow">¶</a></p>
<div id="client-issuers-origin-alias">
<section id="section-7.1">
        <h3 id="name-client-behavior-3">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-client-behavior-3" class="section-name selfRef">Client Behavior</a>
        </h3>
<p id="section-7.1-1">This section describes the Client behavior for generating an one-time-use
request key and signature. Clients provide their Client Secret as input
to the request key generation step, and the rest of the token request inputs
to the signature generation step.<a href="#section-7.1-1" class="pilcrow">¶</a></p>
<div id="index-request">
<section id="section-7.1.1">
          <h4 id="name-request-key">
<a href="#section-7.1.1" class="section-number selfRef">7.1.1. </a><a href="#name-request-key" class="section-name selfRef">Request Key</a>
          </h4>
<p id="section-7.1.1-1">Clients produce <code>request_key</code> by masking Client Key and Client Secret with a
randomly chosen blind. Let <code>pk_sign</code> and <code>sk_sign</code> denote Client Key and
Client Secret, respectively. This process is done as follows:<a href="#section-7.1.1-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.1-2">
<li id="section-7.1.1-2.1">
              <p id="section-7.1.1-2.1.1">Generate a random blind key, sk_blind.<a href="#section-7.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-7.1.1-2.2">
              <p id="section-7.1.1-2.2.1">Blind <code>pk_sign</code> with <code>sk_blind</code> to compute a blinded public key, <code>request_key</code>.<a href="#section-7.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-7.1.1-2.3">
              <p id="section-7.1.1-2.3.1">Output the blinded public key.<a href="#section-7.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.1.1-3">In pseudocode, this is as follows:<a href="#section-7.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.1-4">
<pre>
sk_blind = BKS-BlindKeyGen()
ctx = concat(encode(2, token_type)), "ClientBlind")
blinded_key = BKS-BlindPublicKey(pk_sign, sk_blind, ctx)
request_key = BKS-SerializePublicKey(blinded_key)
request_blind = BKS-SerializePrivatekey(sk_blind)
</pre><a href="#section-7.1.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="index-proof">
<section id="section-7.1.2">
          <h4 id="name-request-signature">
<a href="#section-7.1.2" class="section-number selfRef">7.1.2. </a><a href="#name-request-signature" class="section-name selfRef">Request Signature</a>
          </h4>
<p id="section-7.1.2-1">Clients produce a signature of their request by signing its entire contents
consisting of the following values defined in <a href="#request-one" class="auto internal xref">Section 5.3</a>:
<code>token_key_id</code>, <code>blinded_msg</code>, <code>request_key</code>, <code>issuer_encap_key_id</code>, and <code>encrypted_token_request</code>.
This process requires the blind value <code>sk_blind</code> produced during the <a href="#index-request" class="auto internal xref">Section 7.1.1</a> process.
As above, let pk and sk denote Client Key and Client Secret, respectively. Given these
values, this signature process works as follows:<a href="#section-7.1.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.1.2-2">
<li id="section-7.1.2-2.1">
              <p id="section-7.1.2-2.1.1">Concatenate all signature inputs to yield a message to sign.<a href="#section-7.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-7.1.2-2.2">
              <p id="section-7.1.2-2.2.1">Compute a signature with the blind <code>sk_blind</code> over the input message using
Client Secret, <code>sk_sign</code> as the signing key.<a href="#section-7.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li id="section-7.1.2-2.3">
              <p id="section-7.1.2-2.3.1">Output the signature.<a href="#section-7.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          </ol>
<p id="section-7.1.2-3">In pseudocode, this is as follows:<a href="#section-7.1.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.1.2-4">
<pre>
message = concat(token_type,
                 request_key,
                 issuer_encap_key_id,
                 encode(2, len(encrypted_token_request)),
                 encrypted_token_request)
ctx = concat(encode(2, token_type)), "ClientBlind")
request_signature = BKS-BlindKeySign(sk_sign, sk_blind, ctx, message)
</pre><a href="#section-7.1.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="attester-issuers-origin-alias">
<section id="section-7.2">
        <h3 id="name-attester-behavior-client-re">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-attester-behavior-client-re" class="section-name selfRef">Attester Behavior (Client Request Validation)</a>
        </h3>
<p id="section-7.2-1">Given a TokenRequest request containing <code>request_key</code>, <code>request_signature</code>, and <code>request_blind</code>,
as well as Client Key <code>pk_blind</code>, Attesters verify the signature as follows:<a href="#section-7.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.2-2">
<li id="section-7.2-2.1">
            <p id="section-7.2-2.1.1">Check that <code>request_key</code> is a valid public key. If this fails, abort.<a href="#section-7.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-2.2">
            <p id="section-7.2-2.2.1">Check that <code>request_blind</code> is a valid private key. If this fails, abort.<a href="#section-7.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-2.3">
            <p id="section-7.2-2.3.1">Blind the Client Key <code>pk_sign</code> by blind <code>sk_blind</code>, yielding a blinded key.
If this does not match <code>request_key</code>, abort.<a href="#section-7.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.2-2.4">
            <p id="section-7.2-2.4.1">Verify <code>request_signature</code> over the contents of the request, excluding the
signature itself, using <code>request_key</code>. If signature verification fails, abort.<a href="#section-7.2-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.2-3">In pseudocode, this is as follows:<a href="#section-7.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.2-4">
<pre>
blind_key = BKS-DeserializePublicKey(request_key)
sk_blind = BKS-DeserializePrivatekey(request_blind)
ctx = concat(encode(2, token_type)), "ClientBlind")
pk_blind = BKS-BlindPublicKey(pk_sign, sk_blind, ctx)
if pk_blind != blind_key:
  raise InvalidParameterError

context = parse(request[..len(request)-Nsig]) // this matches context computed during signing
valid = BKS-Verify(blind_key, context, request_signature)
if not valid:
  raise InvalidSignatureError
</pre><a href="#section-7.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="issuer-issuers-origin-alias">
<section id="section-7.3">
        <h3 id="name-issuer-behavior-3">
<a href="#section-7.3" class="section-number selfRef">7.3. </a><a href="#name-issuer-behavior-3" class="section-name selfRef">Issuer Behavior</a>
        </h3>
<p id="section-7.3-1">Given an Issuer Origin Secret (denoted <code>sk_origin</code>) and a TokenRequest, from which
<code>request_key</code> and <code>request_signature</code> are parsed, Issuers verify
the request signature and compute a response as follows:<a href="#section-7.3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.3-2">
<li id="section-7.3-2.1">
            <p id="section-7.3-2.1.1">Check that <code>request_key</code> is a valid public key. If this fails, abort.<a href="#section-7.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.2">
            <p id="section-7.3-2.2.1">Verify <code>request_signature</code> over the contents of the request, excluding the
signature itself, using <code>request_key</code>. If signature verification fails, abort.<a href="#section-7.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.3">
            <p id="section-7.3-2.3.1">Blind <code>request_key</code> by Issuer Origin Secret, <code>sk_origin</code>, yielding an index key.<a href="#section-7.3-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.3-2.4">
            <p id="section-7.3-2.4.1">Output the index key.<a href="#section-7.3-2.4.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.3-3">In pseudocode, this is as follows:<a href="#section-7.3-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.3-4">
<pre>
blind_key = BKS-DeserializePublicKey(request_key)
context = parse(request[..len(request)-Nsig]) // this matches context computed during signing
valid = BKS-Verify(blind_key, context, request_signature)
if not valid:
  raise InvalidSignatureError

ctx = concat(encode(2, token_type)), "IssuerBlind")
evaluated_key = BKS-BlindPublicKey(request_key, sk_origin, ctx)
index_key = BKS-SerializePublicKey(evaluated_key)
</pre><a href="#section-7.3-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="attester-output-issuers-origin-alias">
<section id="section-7.4">
        <h3 id="name-attester-behavior-index-com">
<a href="#section-7.4" class="section-number selfRef">7.4. </a><a href="#name-attester-behavior-index-com" class="section-name selfRef">Attester Behavior (Index Computation)</a>
        </h3>
<p id="section-7.4-1">Given an Issuer response <code>index_key</code>, Client blind <code>sk_blind</code>, and Client
Key (denoted pk_sign), Attesters complete the Issuer's Origin Alias computation as follows:<a href="#section-7.4-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7.4-2">
<li id="section-7.4-2.1">
            <p id="section-7.4-2.1.1">Check that <code>index_key</code> is a valid public key. If this fails, abort.<a href="#section-7.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.4-2.2">
            <p id="section-7.4-2.2.1">Unblind the <code>index_key</code> using the Client blind <code>sk_blind</code>, yielding the index result.<a href="#section-7.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-7.4-2.3">
            <p id="section-7.4-2.3.1">Run HKDF <span>[<a href="#RFC5869" class="cite xref">RFC5869</a>]</span> with the hash function corresponding to the BKS scheme,
using the index result as the secret, Client Key <code>pk_sign</code> as the salt, and
ASCII string "IssuerOriginAlias" as the info string, yielding Issuer's Origin Alias.<a href="#section-7.4-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-7.4-3">In pseudocode, this is as follows:<a href="#section-7.4-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-7.4-4">
<pre>
evaluated_key = BKS-DeserializePublicKey(index_key)
ctx = concat(encode(2, token_type)), "ClientBlind")
unblinded_key = BKS-UnblindPublicKey(evaluated_key, sk_blind, ctx)

index_result = BKS-SerializePublicKey(unblinded_key)
pk_encoded = BKS-SerializePublicKey(pk_sign)

issuer_origin_alias = HKDF-Hash(secret=index_result,
  salt=pk_encoded, info="IssuerOriginAlias")
</pre><a href="#section-7.4-4" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="sec-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">This section describes security considerations relevant to the use of this protocol.<a href="#section-8-1" class="pilcrow">¶</a></p>
<div id="client-secret-use">
<section id="section-8.1">
        <h3 id="name-client-secret-use">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-client-secret-use" class="section-name selfRef">Client Secret Use</a>
        </h3>
<p id="section-8.1-1">The Client Secret key is used for two purposes in this protocol: (1) computing request
signatures and (2) computing the Issuer's Origin Alias (with the corresponding
public key). This is necessary to ensure the client associated with the Issuer's
Origin Alias is the same client that produced a corresponding request. In general, using
the same cryptographic key for two distinct purposes is considered bad practice.
However, analysis of this protocol demonstrates that it is safe in this context.
The Client Secret MUST NOT be used for any purpose outside of this protocol.<a href="#section-8.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="custom-token-request-encapsulation">
<section id="section-8.2">
        <h3 id="name-custom-token-request-encaps">
<a href="#section-8.2" class="section-number selfRef">8.2. </a><a href="#name-custom-token-request-encaps" class="section-name selfRef">Custom Token Request Encapsulation</a>
        </h3>
<p id="section-8.2-1">The protocol in this document uses <span>[<a href="#HPKE" class="cite xref">HPKE</a>]</span> directly to encrypt token request information
to the issuer while also authenticating information exposed to the attester. Oblivious HTTP
<span>[<a href="#OHTTP" class="cite xref">OHTTP</a>]</span>, which is a protocol built on top of HPKE for
request encapsulation, is not suitable for this purpose since it does not allow clients to
additionally authenticate application-layer information that is visible to intermediaries,
which is the case for the data visible to the Attester.<a href="#section-8.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="channel-security">
<section id="section-8.3">
        <h3 id="name-channel-security">
<a href="#section-8.3" class="section-number selfRef">8.3. </a><a href="#name-channel-security" class="section-name selfRef">Channel Security</a>
        </h3>
<p id="section-8.3-1">An attacker that can act as an intermediate between Attester and Issuer
communication can influence or disrupt the ability for the Issuer to correctly
rate-limit token issuance.  All communication channels use server-authenticated
HTTPS. Some connections, e.g., between an Attester and an Issuer, require
mutual authentication between both endpoints. Where appropriate, endpoints
MAY use further enhancements such as TLS certificate pinning to mitigate
the risk of channel compromise.<a href="#section-8.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="issuance-unlinkability">
<section id="section-8.4">
        <h3 id="name-token-request-unlinkability">
<a href="#section-8.4" class="section-number selfRef">8.4. </a><a href="#name-token-request-unlinkability" class="section-name selfRef">Token Request Unlinkability and Unforgeability</a>
        </h3>
<p id="section-8.4-1">Client token requests are constructed such that an Issuer cannot distinguish between
any two token requests from the same Client and two requests from different Clients.
We refer to this property as issuance unlinkability. This property is achieved
by the way the tokens are constructed. In particular, TokenRequest.request_key and TokenRequest.request_signature
are the only value in a TokenRequest that is derived from per-Client information, i.e.,
the Client Secret.<a href="#section-8.4-1" class="pilcrow">¶</a></p>
<p id="section-8.4-2">TokenRequest.request_key is computed using a freshly generated blind for each token
request. As a result, the value of TokenRequest.request_key in one token request is
statistically independent from Client Key. Similarly, TokenRequest.request_signature
is computed using the same freshly generated blind as TokenRequest.request_key for each
token request, and the resulting signature is therefore independent from signatures
produced using Client Secret. More details about this unlinkability property can be
found in <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>.<a href="#section-8.4-2" class="pilcrow">¶</a></p>
<p id="section-8.4-3">This unlinkability property is only intended for requests observed by the Issuer.
In contrast, the Attester is required to link requests from the same Client together
for the purposes of enforcing rate limits. This Attester does this by observing the
Client Key. Importantly, the Client Key is not sent to the Issuer during the issuance
flow, as doing this would allow the Issuer to trivially link two requests to the same
Client.<a href="#section-8.4-3" class="pilcrow">¶</a></p>
<p id="section-8.4-4">The token request signature is also required to be unforgeable. Informally, unforgeability
means that no entity can produce a valid (message, signature) pair for any blinding key without
access to the private signing key. Importantly, the means the Attester cannot forge
signatures on behalf of a given Client in an attempt to learn the origin name.<a href="#section-8.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="info-disclosure">
<section id="section-8.5">
        <h3 id="name-information-disclosure">
<a href="#section-8.5" class="section-number selfRef">8.5. </a><a href="#name-information-disclosure" class="section-name selfRef">Information Disclosure</a>
        </h3>
<p id="section-8.5-1">The protocol in this document is designed such that information pertaining to issuance
of a token is limited to parties that need it for completing the protocol. In particular,
honest-but-curious Attesters learn only the Issuer's Origin Alias as described in
<a href="#issuers-origin-alias" class="auto internal xref">Section 7</a>, any per-Client information necessary for attestation, and the
target Issuer for a given token request. The Attester does not directly learn the origin
name associated with a given token request, though it does learn the distribution of tokens
across Client interactions. This auxiliary information could be used to infer the Origin
for a given token. For example, if an Issuer has only two configured Origins, each with
a different token request pattern, then the distribution of Client tokens might reveal
the Origin associated with a given token.<a href="#section-8.5-1" class="pilcrow">¶</a></p>
<p id="section-8.5-2">Malicious or otherwise compromised Attesters can choose to not follow the protocol described
in this specification, allowing, for example, Clients to bypass rate limits imposed by
Origins. Moreover, malicious Attesters could reveal the per-request blind (request_blind)
to Issuers, breaking the unlinkability property described in <a href="#issuance-unlinkability" class="auto internal xref">Section 8.4</a>.<a href="#section-8.5-2" class="pilcrow">¶</a></p>
<p id="section-8.5-3">Honest-but-curious Issuers only learn the Attester that vouches for a particular Client's
token request and the origin name associated with a token request. Issuers do not learn
the Issuer's Origin Alias or any per-Client information used when creating a token
request.<a href="#section-8.5-3" class="pilcrow">¶</a></p>
<p id="section-8.5-4">Conversely, malicious Issuers that do not follow the protocol can choose to not validate
the token request signature, thereby allowing others to forge token requests in an attempt
to learn the origin name. Malicious Issuers can also rotate token signing keys or Issuer
Origin Secret values frequently in an attempt to bypass Attester-enforced rate limits.
Both of these are detectable by the Attester, though. Issuers can also lie about per-origin
rate limits without detection, e.g., by increasing the limit to a value well beyond any configured
limit by an Origin, or return different limits for different origins to the Attester.<a href="#section-8.5-4" class="pilcrow">¶</a></p>
<p id="section-8.5-5">Clients learn the output token. They do not learn the Issuer's Origin Alias, though the
security of the protocol does not depend on keeping this value secret from Clients. Moreover,
even malicious Clients cannot tamper with per-Client state stored on the Attester for other
Clients, as doing so requires knowledge of their unique Client Secret.<a href="#section-8.5-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="rate-limit-enforcement">
<section id="section-8.6">
        <h3 id="name-rate-limit-enforcement">
<a href="#section-8.6" class="section-number selfRef">8.6. </a><a href="#name-rate-limit-enforcement" class="section-name selfRef">Rate Limit Enforcement</a>
        </h3>
<p id="section-8.6-1">Since the purpose of this token variant is to allow rate limits to be enforced on token
issuance to Clients, the accuracy of the rate limit is an important part of evaluating
the efficacy and security of a given deployment.<a href="#section-8.6-1" class="pilcrow">¶</a></p>
<p id="section-8.6-2">The rate limit is enforced by the Attester based on state about the Client that only
the Attester holds, where the state is kept on a per-Issuer and per-Origin basis. This means
that the selection of both the Issuer and the Attester determines the state for the rate
limit. As such, Origins SHOULD only send challenges for a single Issuer within a given
period of time, in order to ensure that a Client is not able to get tokens across
multiple Issuers and exceed the rate limit. Similarly, Issuers need to be selective
in which Attesters they allow, to ensure that a single Client cannot trivially work
with many Attesters in order to exceed the rate limit.<a href="#section-8.6-2" class="pilcrow">¶</a></p>
<p id="section-8.6-3">Since the effectiveness of the rate limit requires a bounded set of Attesters for any
particular use case, deployments need to consider the impact on centralization in order
to ensure that new Attesters can still join the overall ecosystem. See the discussion
on centralization in <span>[<a href="#ARCH" class="cite xref">ARCH</a>]</span>.<a href="#section-8.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">This section describes privacy considerations relevant to use of this protocol.<a href="#section-9-1" class="pilcrow">¶</a></p>
<div id="client-token-state-and-origin-tracking">
<section id="section-9.1">
        <h3 id="name-client-token-state-and-orig">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-client-token-state-and-orig" class="section-name selfRef">Client Token State and Origin Tracking</a>
        </h3>
<p id="section-9.1-1">Origins SHOULD only generate token challenges based on client action, such as when a user
loads a website. Clients SHOULD ignore token challenges if an Origin tries to force the
client to present tokens multiple times without any new client-initiated action. Failure
to do so can allow malicious origins to track clients across contexts. Specifically, an
origin can abuse per-user token limits for tracking by assigning each new client a random
token count and observing whether or not the client can successfully redeem that many
tokens in a given context. If any token redemption fails, then the origin learns information
about how many tokens that client had previously been issued.<a href="#section-9.1-1" class="pilcrow">¶</a></p>
<p id="section-9.1-2">By rejecting repeated or duplicative challenges within a single context, the origin only
learns a single bit of information: whether or not the client had any token quota left
in the given policy window.<a href="#section-9.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="origin-verification">
<section id="section-9.2">
        <h3 id="name-origin-verification">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-origin-verification" class="section-name selfRef">Origin Verification</a>
        </h3>
<p id="section-9.2-1">Rate-limited tokens are defined in terms of a Client authenticating to an Origin, where
the "origin" is used as defined in <span>[<a href="#RFC6454" class="cite xref">RFC6454</a>]</span>. In order to limit cross-origin correlation,
Clients MUST verify that the name of the origin that is providing the HTTP authentication
challenge is present in the TokenChallenge.origin_info list (<span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>), where the
matching logic is defined for same-origin policies in <span>[<a href="#RFC6454" class="cite xref">RFC6454</a>]</span>. Clients MAY further limit
which authentication challenges they are willing to respond to, for example by only accepting
challenges when the origin is a web site to which the user navigated.<a href="#section-9.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-identification-with-unique-encapsulation-keys">
<section id="section-9.3">
        <h3 id="name-client-identification-with-">
<a href="#section-9.3" class="section-number selfRef">9.3. </a><a href="#name-client-identification-with-" class="section-name selfRef">Client Identification with Unique Encapsulation Keys</a>
        </h3>
<p id="section-9.3-1">Client activity could be linked if an Origin and Issuer collude to have unique keys targeted
at specific Clients or sets of Clients.<a href="#section-9.3-1" class="pilcrow">¶</a></p>
<p id="section-9.3-2">As with the basic issuance protocol <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>, the token_key_id is truncated to a single
octet to mitigate the risk of unique keys per client.<a href="#section-9.3-2" class="pilcrow">¶</a></p>
<p id="section-9.3-3">Clients SHOULD check encapsulation key consistency to help mitigate targeting attacks. Consistency for Privacy Pass resources such as Issuer directories and token keys is described in
<span>[<a href="#CONSISTENCY" class="cite xref">CONSISTENCY</a>]</span>.
<span>[<a href="#CONSISTENCY-MIRROR" class="cite xref">CONSISTENCY-MIRROR</a>]</span> describes a specific
approach in which Clients can check the consistency of a key using a mirror server.
Since encapsulation keys are available in the Issuer well-known configuration (<a href="#setup" class="auto internal xref">Section 3</a>),
the Client can fetch the configuration via a mirror to perform a consistency check.<a href="#section-9.3-3" class="pilcrow">¶</a></p>
<p id="section-9.3-4">Clients can also detect inconsistency if the encapsulation key changes across multiple
challenges (indicating that an Origin might be trying to target Clients, but did not
recognize the Client across two requests). Encapsulation key changes within a short
period of time can indicate that the Origin is attempting to target the Client.<a href="#section-9.3-4" class="pilcrow">¶</a></p>
<p id="section-9.3-5">The Attester can also help ensure consistency with an in-band check, which conforms
to the approach in <span>[<a href="#CONSISTENCY-INBAND" class="cite xref">CONSISTENCY-INBAND</a>]</span>.
The Attester can observe and validate the issuer_encap_key_id presented by the Client to
the Issuer. As described in <a href="#request-one" class="auto internal xref">Section 5.3</a>, Attesters MUST validate that the
issuer_encap_key_id in the Client's TokenRequest matches a known Issuer
Encapsulation Key public key for the Issuer. The Attester needs to support key rotation, but
ought to disallow very rapid key changes, which could indicate that an Origin is colluding with
an Issuer to try to rotate the key for each new Client in order to link the client activity.<a href="#section-9.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="client-identification-with-unique-per-origin-token-keys">
<section id="section-9.4">
        <h3 id="name-client-identification-with-u">
<a href="#section-9.4" class="section-number selfRef">9.4. </a><a href="#name-client-identification-with-u" class="section-name selfRef">Client Identification with Unique Per-Origin Token Keys</a>
        </h3>
<p id="section-9.4-1">Client activity could also be linked if an Origin and Issuer collude to use a unique
per-origin Token Key.<a href="#section-9.4-1" class="pilcrow">¶</a></p>
<p id="section-9.4-2">Since Attesters do not see per-origin identities that can be correlated across Clients,
Attesters cannot perform in-band consistency checks.<a href="#section-9.4-2" class="pilcrow">¶</a></p>
<p id="section-9.4-3">Clients SHOULD check encapsulation key consistency to help mitigate targeting attacks.
Consistency for Privacy Pass resources such as Issuer directories and token keys is described in
<span>[<a href="#CONSISTENCY" class="cite xref">CONSISTENCY</a>]</span>.
<span>[<a href="#CONSISTENCY-MIRROR" class="cite xref">CONSISTENCY-MIRROR</a>]</span> describes a specific
approach in which Clients can check the consistency of a key using a mirror server.
Since per-origin token keys are available in the Issuer well-known configuration (<a href="#setup" class="auto internal xref">Section 3</a>),
the Client can fetch the configuration via a mirror to perform a consistency check.<a href="#section-9.4-3" class="pilcrow">¶</a></p>
<p id="section-9.4-4">Clients can detect inconsistency if the token key for an Origin-Issuer pair changes across
multiple challenges (indicating that an Origin might be trying to target Clients, but did not
recognize the Client across two requests). Token key changes within a short
period of time can indicate that the Origin is attempting to target the Client.<a href="#section-9.4-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="origin-identification">
<section id="section-9.5">
        <h3 id="name-origin-identification">
<a href="#section-9.5" class="section-number selfRef">9.5. </a><a href="#name-origin-identification" class="section-name selfRef">Origin Identification</a>
        </h3>
<p id="section-9.5-1">As stated in <a href="#properties" class="auto internal xref">Section 1.3</a>, the design of this protocol is such that Attesters cannot
learn the identity of origins that Clients are accessing. The Origin Name itself is
encrypted in the request between the Client and the Issuer, so the Attester cannot
directly learn the value. However, in order to prevent the Attester from inferring the
value, additional constraints need to be added:<a href="#section-9.5-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-9.5-2.1">
            <p id="section-9.5-2.1.1">Each Issuer SHOULD serve tokens to a large number of Origins. A one-to-one relationship
between Origin and Issuer would allow an Attester to infer which Origin is accessed
simply by observing the Issuer identity.<a href="#section-9.5-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.5-2.2">
            <p id="section-9.5-2.2.1">Issuers SHOULD NOT return rate-limit values that are specific to Origins, such
that an Attester can infer which Origin is accessed by observing the rate limit. This
can be mitigated by having many Origins share the same rate-limit value.<a href="#section-9.5-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-9.5-2.3">
            <p id="section-9.5-2.3.1">If an Issuer changes the rate-limit values for a single Origin, that change occurring
at the same time across multiple Clients could allow Attesters to recognize an Origin
in common across Clients. To mitigate this, Issuers either can change the limits for
multiple Origins simultaneously, or have an Origin switch to a separate Issuer.<a href="#section-9.5-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-9.5-3">Some deployments MAY choose to relax these requirements, such as in cases where the
origins being accessed are ubiquitous or do not correspond to user-specific behavior.<a href="#section-9.5-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="collusion">
<section id="section-9.6">
        <h3 id="name-collusion-among-different-e">
<a href="#section-9.6" class="section-number selfRef">9.6. </a><a href="#name-collusion-among-different-e" class="section-name selfRef">Collusion Among Different Entities</a>
        </h3>
<p id="section-9.6-1">Collusion among the different entities in the Privacy Pass architecture can result in
exposure of a client's per-origin access patterns.<a href="#section-9.6-1" class="pilcrow">¶</a></p>
<p id="section-9.6-2">For this issuance protocol, Issuers and Attesters should be run by mutually distinct
organizations to limit information sharing. A single entity running an Issuer and Attester
for a single token issuance flow can view the origins being accessed by a given client.
Running the Issuer and Attester in this 'single Issuer/Attester' fashion reduces the privacy
promises of no one entity being able to learn Client browsing patterns. This may be desirable
for a redemption flow that is limited to specific Issuers and Attesters, but should be avoided
where hiding origin names from the Attester is desirable.<a href="#section-9.6-2" class="pilcrow">¶</a></p>
<p id="section-9.6-3">If a Attester and Origin are able to collude, they can correlate a client's identity
and origin access patterns through timestamp correlation. The timing of a request to an
Origin and subsequent token issuance to a Attester can reveal the Client
identity (as known to the Attester) to the Origin, especially if repeated over multiple accesses.<a href="#section-9.6-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="deploy">
<section id="section-10">
      <h2 id="name-deployment-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-deployment-considerations" class="section-name selfRef">Deployment Considerations</a>
      </h2>
<div id="token-key-management">
<section id="section-10.1">
        <h3 id="name-token-key-management">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-token-key-management" class="section-name selfRef">Token Key Management</a>
        </h3>
<p id="section-10.1-1">Issuers SHOULD generate new (Token Key, Issuer Origin Secret) values regularly, and
SHOULD maintain old and new secrets to allow for graceful updates. The RECOMMENDED
rotation interval is two times the length of the policy window for that
information. During generation, issuers must ensure the <code>token_key_id</code> (the 8-bit
prefix of SHA256(Token Key)) is different from all other <code>token_key_id</code>
values for that Origin currently in rotation. One way to ensure this uniqueness
is via rejection sampling, where a new key is generated until its <code>token_key_id</code> is
unique among all currently in rotation for the Origin.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-11">
      <h2 id="name-iana-considerations">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA considerations</a>
      </h2>
<div id="iana-token-type">
<section id="section-11.1">
        <h3 id="name-token-type">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-token-type" class="section-name selfRef">Token Type</a>
        </h3>
<p id="section-11.1-1">This document updates the "Token Type" Registry (<span>[<a href="#AUTHSCHEME" class="cite xref">AUTHSCHEME</a>]</span>) with the following value:<a href="#section-11.1-1" class="pilcrow">¶</a></p>
<span id="name-token-types"></span><div id="aeadid-values">
<table class="center" id="table-2">
          <caption>
<a href="#table-2" class="selfRef">Table 2</a>:
<a href="#name-token-types" class="selfRef">Token Types</a>
          </caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">Value</th>
              <th class="text-left" rowspan="1" colspan="1">Name</th>
              <th class="text-left" rowspan="1" colspan="1">Publicly Verifiable</th>
              <th class="text-left" rowspan="1" colspan="1">Public Metadata</th>
              <th class="text-left" rowspan="1" colspan="1">Private Metadata</th>
              <th class="text-left" rowspan="1" colspan="1">Nk</th>
              <th class="text-left" rowspan="1" colspan="1">Nid</th>
              <th class="text-left" rowspan="1" colspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0003</td>
              <td class="text-left" rowspan="1" colspan="1">Rate-Limited Blind RSA(SHA-384, 2048-bit) with ECDSA(P-384, SHA-384)</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">512</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">0x0004</td>
              <td class="text-left" rowspan="1" colspan="1">Rate-Limited Blind RSA(SHA-384, 2048-bit) with Ed25519(SHA-512)</td>
              <td class="text-left" rowspan="1" colspan="1">Y</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">N</td>
              <td class="text-left" rowspan="1" colspan="1">512</td>
              <td class="text-left" rowspan="1" colspan="1">32</td>
              <td class="text-left" rowspan="1" colspan="1">This document</td>
            </tr>
          </tbody>
        </table>
</div>
<p id="section-11.1-3">The details of the signature scheme with key blinding and unblinding functions for each token type above are described in the following sections.<a href="#section-11.1-3" class="pilcrow">¶</a></p>
<div id="ecdsa-sig-functions">
<section id="section-11.1.1">
          <h4 id="name-ecdsa-based-token-type">
<a href="#section-11.1.1" class="section-number selfRef">11.1.1. </a><a href="#name-ecdsa-based-token-type" class="section-name selfRef">ECDSA-based Token Type</a>
          </h4>
<p id="section-11.1.1-1">This section describes the implementation details of the signature scheme with key
blinding and unblinding functions introduced in <a href="#issuers-origin-alias" class="auto internal xref">Section 7</a> using
<span>[<a href="#ECDSA" class="cite xref">ECDSA</a>]</span> with P-384 as the underlying elliptic curve and SHA-384 as the corresponding
hash function.<a href="#section-11.1.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1.1-2.1">
              <p id="section-11.1.1-2.1.1">BKS-KeyGen(): Generate a random ECDSA private and public key pair (sk, pk).<a href="#section-11.1.1-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.2">
              <p id="section-11.1.1-2.2.1">BKS-BlindKeyGen(): Generate a random ECDSA private key bk.<a href="#section-11.1.1-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.3">
              <p id="section-11.1.1-2.3.1">BKS-BlindPublicKey(pk, bk, ctx): Produce a blinded public key based on the input public
key pk, blind bk, and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>, Section 6.1.<a href="#section-11.1.1-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.4">
              <p id="section-11.1.1-2.4.1">BKS-UnblindPublicKey(pk, bk, ctx): Produce an unblinded public key based on the input
blinded public key pk, blind bk, and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>, Section 6.1.<a href="#section-11.1.1-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.5">
              <p id="section-11.1.1-2.5.1">BKS-Verify(pk, msg, sig): Verify the DER-encoded <span>[<a href="#X690" class="cite xref">X690</a>]</span> BKS-Sig-Value signature
sig over input message msg against the ECDSA public key pk, producing a boolean value indicating success.<a href="#section-11.1.1-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.6">
              <p id="section-11.1.1-2.6.1">BKS-BlindKeySign(sk_sign, sk_blind, ctx, msg): Sign input message msg with signing key sk_sign, blind sk_blind,
and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>, Section 6.2, and serializes the resulting signature
pair (r, s) in "raw" form, i.e., as the concatenation of two 48-byte, big endian scalars,
yielding an <code>Nsig=96</code> byte signature.<a href="#section-11.1.1-2.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.7">
              <p id="section-11.1.1-2.7.1">BKS-SerializePrivatekey(sk): Serialize an ECDSA private key using the Field-Element-to-Octet-String
conversion according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>.<a href="#section-11.1.1-2.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.8">
              <p id="section-11.1.1-2.8.1">BKS-DeserializePrivatekey(buf): Attempt to deserialize an ECDSA private key from a 48-byte
string buf using Octet-String-to-Field-Element from <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>. This function can fail if buf
does not represent a valid private key.<a href="#section-11.1.1-2.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.9">
              <p id="section-11.1.1-2.9.1">BKS-SerializePublicKey(pk): Serialize an ECDSA public key using the
compressed Elliptic-Curve-Point-to-Octet-String method according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>.<a href="#section-11.1.1-2.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.1-2.10">
              <p id="section-11.1.1-2.10.1">BKS-DeserializePublicKey(buf): Attempt to deserialize a public key using
the compressed Octet-String-to-Elliptic-Curve-Point method according to <span>[<a href="#SECG" class="cite xref">SECG</a>]</span>,
and then performs partial public-key validation as defined in section 5.6.2.3.4 of
<span>[<a href="#KEYAGREEMENT" class="cite xref">KEYAGREEMENT</a>]</span>. This validation includes checking
that the coordinates are in the correct range, that the point is on the curve, and
that the point is not the point at infinity.<a href="#section-11.1.1-2.10.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
<div id="eddsa-sig-functions">
<section id="section-11.1.2">
          <h4 id="name-ed25519-based-token-type">
<a href="#section-11.1.2" class="section-number selfRef">11.1.2. </a><a href="#name-ed25519-based-token-type" class="section-name selfRef">Ed25519-based Token Type</a>
          </h4>
<p id="section-11.1.2-1">This section describes the implementation details of the signature scheme with key
blinding and unblinding functions introduced in <a href="#issuers-origin-alias" class="auto internal xref">Section 7</a> using
Ed25519 as described in <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>]</span>.<a href="#section-11.1.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-11.1.2-2.1">
              <p id="section-11.1.2-2.1.1">BKS-KeyGen(): Generate a random Ed25519 private and public key pair (sk, pk), where
sk is randomly generated 32 bytes (See <span>[<a href="#RFC4086" class="cite xref">RFC4086</a>]</span> for information about randomness
generation) and pk is computed according to <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>], <a href="https://rfc-editor.org/rfc/rfc8032#section-5.1.5" class="relref">Section 5.1.5</a></span>.<a href="#section-11.1.2-2.1.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.2">
              <p id="section-11.1.2-2.2.1">BKS-BlindKeyGen(): Generate and output 32 random bytes.<a href="#section-11.1.2-2.2.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.3">
              <p id="section-11.1.2-2.3.1">BKS-BlindPublicKey(pk, bk, ctx): Produce a blinded public key based on the input public
key pk, blind bk, and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-signature-key-blinding-04#section-5.1" class="relref">Section 5.1</a></span>.<a href="#section-11.1.2-2.3.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.4">
              <p id="section-11.1.2-2.4.1">BKS-UnblindPublicKey(pk, bk, ctx): Produce an unblinded public key based on the input
blinded public key pk, blind bk, and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>]</span>, Section 5.1.<a href="#section-11.1.2-2.4.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.5">
              <p id="section-11.1.2-2.5.1">BKS-Verify(pk, msg, sig): Verify the signature sig over input message msg against
the Ed25519 public key pk, as defined in <span>[<a href="#RFC8032" class="cite xref">RFC8032</a>], <a href="https://rfc-editor.org/rfc/rfc8032#section-5.1.7" class="relref">Section 5.1.7</a></span>, producing a
boolean value indicating success.<a href="#section-11.1.2-2.5.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.6">
              <p id="section-11.1.2-2.6.1">BKS-BlindKeySign(sk_sign, sk_blind, ctx, msg): Sign input message msg with signing key sk_sign, blind
sk_blind, and context ctx according to <span>[<a href="#KEYBLINDING" class="cite xref">KEYBLINDING</a>], <a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-signature-key-blinding-04#section-5.2" class="relref">Section 5.2</a></span>, yielding an <code>Nsig=64</code> byte signature.<a href="#section-11.1.2-2.6.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.7">
              <p id="section-11.1.2-2.7.1">BKS-SerializePrivatekey(sk): Identity function which outputs sk as an <code>Nsk=32</code> byte buffer.<a href="#section-11.1.2-2.7.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.8">
              <p id="section-11.1.2-2.8.1">BKS-DeserializePrivatekey(buf): Identity function which outputs buf interpreted as <code>sk</code>.<a href="#section-11.1.2-2.8.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.9">
              <p id="section-11.1.2-2.9.1">BKS-SerializePublicKey(pk): Identity function which outputs pk as an <code>Npk=32</code> byte buffer.<a href="#section-11.1.2-2.9.1" class="pilcrow">¶</a></p>
</li>
            <li class="normal" id="section-11.1.2-2.10">
              <p id="section-11.1.2-2.10.1">BKS-DeserializePublicKey(buf): Identity function which outputs buf interpreted as <code>pk</code>.<a href="#section-11.1.2-2.10.1" class="pilcrow">¶</a></p>
</li>
          </ul>
</section>
</div>
</section>
</div>
<div id="iana-headers">
<section id="section-11.2">
        <h3 id="name-http-headers">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-http-headers" class="section-name selfRef">HTTP Headers</a>
        </h3>
<p id="section-11.2-1">This document registers four new headers for use on the token issuance path
in the "Hypertext Transfer Protocol (HTTP) Field Name Registry" &lt;<span><a href="https://www.iana.org/assignments/http-fields">https://www.iana.org/assignments/http-fields</a></span>&gt;.<a href="#section-11.2-1" class="pilcrow">¶</a></p>
<span id="name-registered-http-header"></span><div id="iana-header-type-table">
<figure id="figure-4">
          <div class="alignLeft art-text artwork" id="section-11.2-2.1">
<pre>
    +-------------------------+----------+--------+---------------+
    | Header Field Name       | Protocol | Status |   Reference   |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Origin-Alias  |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Client        |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Request-Blind |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
    | Sec-Token-Limit         |   http   |  std   | This document |
    +-------------------------+----------+--------+---------------+
</pre>
</div>
<figcaption><a href="#figure-4" class="selfRef">Figure 4</a>:
<a href="#name-registered-http-header" class="selfRef">Registered HTTP Header</a>
          </figcaption></figure>
</div>
</section>
</div>
</section>
</div>
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="ARCH">[ARCH]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Iyengar, J.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The Privacy Pass Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-architecture-16</span>, <time datetime="2023-09-25" class="refDate">25 September 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-architecture-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="AUTHSCHEME">[AUTHSCHEME]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Valdez, S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The Privacy Pass HTTP Authentication Scheme"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-auth-scheme-15</span>, <time datetime="2023-10-23" class="refDate">23 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-auth-scheme-15</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="BLINDSIG">[BLINDSIG]</dt>
        <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Jacobs, F.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"RSA Blind Signatures"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-rsa-blind-signatures-14</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-14">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-rsa-blind-signatures-14</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ECDSA">[ECDSA]</dt>
        <dd>
<span class="refAuthor">American National Standards Institute</span>, <span class="refTitle">"Public Key Cryptography for the Financial Services Industry - The Elliptic Curve Digital Signature Algorithm (ECDSA)"</span>, <span class="seriesInfo">ANSI ANS X9.62-2005</span>, <time datetime="2005-11" class="refDate">November 2005</time>. </dd>
<dd class="break"></dd>
<dt id="HPKE">[HPKE]</dt>
        <dd>
<span class="refAuthor">Barnes, R.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="seriesInfo">RFC 9180</span>, <span class="seriesInfo">DOI 10.17487/RFC9180</span>, <time datetime="2022-02" class="refDate">February 2022</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9180">https://www.rfc-editor.org/rfc/rfc9180</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="ISSUANCE">[ISSUANCE]</dt>
        <dd>
<span class="refAuthor">Celi, S.</span>, <span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Valdez, S.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Privacy Pass Issuance Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-protocol-16</span>, <time datetime="2023-10-03" class="refDate">3 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-protocol-16</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEYAGREEMENT">[KEYAGREEMENT]</dt>
        <dd>
<span class="refAuthor">Barker, E.</span>, <span class="refAuthor">Chen, L.</span>, <span class="refAuthor">Roginsky, A.</span>, <span class="refAuthor">Vassilev, A.</span>, and <span class="refAuthor">R. Davis</span>, <span class="refTitle">"Recommendation for pair-wise key-establishment schemes using discrete logarithm cryptography"</span>, <span class="refContent">National Institute of Standards and Technology</span>, <span class="seriesInfo">DOI 10.6028/nist.sp.800-56ar3</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://doi.org/10.6028/nist.sp.800-56ar3">https://doi.org/10.6028/nist.sp.800-56ar3</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEYBLINDING">[KEYBLINDING]</dt>
        <dd>
<span class="refAuthor">Denis, F.</span>, <span class="refAuthor">Eaton, E.</span>, <span class="refAuthor">Lepoint, T.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Key Blinding for Signature Schemes"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-signature-key-blinding-04</span>, <time datetime="2023-07-23" class="refDate">23 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-signature-key-blinding-04">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-signature-key-blinding-04</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5869">[RFC5869]</dt>
        <dd>
<span class="refAuthor">Krawczyk, H.</span> and <span class="refAuthor">P. Eronen</span>, <span class="refTitle">"HMAC-based Extract-and-Expand Key Derivation Function (HKDF)"</span>, <span class="seriesInfo">RFC 5869</span>, <span class="seriesInfo">DOI 10.17487/RFC5869</span>, <time datetime="2010-05" class="refDate">May 2010</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc5869">https://www.rfc-editor.org/rfc/rfc5869</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6454">[RFC6454]</dt>
        <dd>
<span class="refAuthor">Barth, A.</span>, <span class="refTitle">"The Web Origin Concept"</span>, <span class="seriesInfo">RFC 6454</span>, <span class="seriesInfo">DOI 10.17487/RFC6454</span>, <time datetime="2011-12" class="refDate">December 2011</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6454">https://www.rfc-editor.org/rfc/rfc6454</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6570">[RFC6570]</dt>
        <dd>
<span class="refAuthor">Gregorio, J.</span>, <span class="refAuthor">Fielding, R.</span>, <span class="refAuthor">Hadley, M.</span>, <span class="refAuthor">Nottingham, M.</span>, and <span class="refAuthor">D. Orchard</span>, <span class="refTitle">"URI Template"</span>, <span class="seriesInfo">RFC 6570</span>, <span class="seriesInfo">DOI 10.17487/RFC6570</span>, <time datetime="2012-03" class="refDate">March 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc6570">https://www.rfc-editor.org/rfc/rfc6570</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8032">[RFC8032]</dt>
        <dd>
<span class="refAuthor">Josefsson, S.</span> and <span class="refAuthor">I. Liusvaara</span>, <span class="refTitle">"Edwards-Curve Digital Signature Algorithm (EdDSA)"</span>, <span class="seriesInfo">RFC 8032</span>, <span class="seriesInfo">DOI 10.17487/RFC8032</span>, <time datetime="2017-01" class="refDate">January 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8032">https://www.rfc-editor.org/rfc/rfc8032</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8941">[RFC8941]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span> and <span class="refAuthor">P. Kamp</span>, <span class="refTitle">"Structured Field Values for HTTP"</span>, <span class="seriesInfo">RFC 8941</span>, <span class="seriesInfo">DOI 10.17487/RFC8941</span>, <time datetime="2021-02" class="refDate">February 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8941">https://www.rfc-editor.org/rfc/rfc8941</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SECG">[SECG]</dt>
        <dd>
<span class="refTitle">"Elliptic Curve Cryptography, Standards for Efficient Cryptography Group, ver. 2"</span>, <time datetime="2009" class="refDate">2009</time>, <span>&lt;<a href="https://secg.org/sec1-v2.pdf">https://secg.org/sec1-v2.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="TLS13">[TLS13]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refTitle">"The Transport Layer Security (TLS) Protocol Version 1.3"</span>, <span class="seriesInfo">RFC 8446</span>, <span class="seriesInfo">DOI 10.17487/RFC8446</span>, <time datetime="2018-08" class="refDate">August 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8446">https://www.rfc-editor.org/rfc/rfc8446</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="X690">[X690]</dt>
      <dd>
<span class="refAuthor">ITU-T</span>, <span class="refTitle">"Information technology - ASN.1 encoding Rules: Specification of Basic Encoding Rules (BER), Canonical Encoding Rules (CER) and Distinguished Encoding Rules (DER)"</span>, <span class="seriesInfo">ISO/IEC 8824-1:2021 </span>, <time datetime="2021-02" class="refDate">February 2021</time>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="CONSISTENCY">[CONSISTENCY]</dt>
        <dd>
<span class="refAuthor">Davidson, A.</span>, <span class="refAuthor">Finkel, M.</span>, <span class="refAuthor">Thomson, M.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Key Consistency and Discovery"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-privacypass-key-consistency-01</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01">https://datatracker.ietf.org/doc/html/draft-ietf-privacypass-key-consistency-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONSISTENCY-INBAND">[CONSISTENCY-INBAND]</dt>
        <dd>
<span class="refAuthor">Pauly, T.</span> and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Privacy Pass In-Band Key Consistency Checks"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-pw-privacypass-in-band-consistency-00</span>, <time datetime="2023-07-10" class="refDate">10 July 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-pw-privacypass-in-band-consistency-00">https://datatracker.ietf.org/doc/html/draft-pw-privacypass-in-band-consistency-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CONSISTENCY-MIRROR">[CONSISTENCY-MIRROR]</dt>
        <dd>
<span class="refAuthor">Beurdouche, B.</span>, <span class="refAuthor">Finkel, M.</span>, <span class="refAuthor">Valdez, S.</span>, <span class="refAuthor">Wood, C. A.</span>, and <span class="refAuthor">T. Pauly</span>, <span class="refTitle">"Checking Resource Consistency with HTTP Mirrors"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-group-privacypass-consistency-mirror-01</span>, <time datetime="2023-10-23" class="refDate">23 October 2023</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-group-privacypass-consistency-mirror-01">https://datatracker.ietf.org/doc/html/draft-group-privacypass-consistency-mirror-01</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OHTTP">[OHTTP]</dt>
        <dd>
<span class="refTitle">"*** BROKEN REFERENCE ***"</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4086">[RFC4086]</dt>
      <dd>
<span class="refAuthor">Eastlake 3rd, D.</span>, <span class="refAuthor">Schiller, J.</span>, and <span class="refAuthor">S. Crocker</span>, <span class="refTitle">"Randomness Requirements for Security"</span>, <span class="seriesInfo">BCP 106</span>, <span class="seriesInfo">RFC 4086</span>, <span class="seriesInfo">DOI 10.17487/RFC4086</span>, <time datetime="2005-06" class="refDate">June 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc4086">https://www.rfc-editor.org/rfc/rfc4086</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
<div id="acknowledgements">
<section id="appendix-A">
      <h2 id="name-acknowledgements">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="appendix-A-1">The authors of this document would like to acknowledge feedback from contributors
to the Privacy Pass working group for their help in improving this document.
The authors also thank Frank Denis and David Schinazi for their contributions.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="test-vectors">
<section id="appendix-B">
      <h2 id="name-test-vectors">
<a href="#appendix-B" class="section-number selfRef">Appendix B. </a><a href="#name-test-vectors" class="section-name selfRef">Test Vectors</a>
      </h2>
<p id="appendix-B-1">This section includes test vectors for Origin Name encryption in <a href="#encrypt-origin" class="auto internal xref">Section 6</a>
and Client's Origin Alias computation in <a href="#issuers-origin-alias" class="auto internal xref">Section 7</a>. Test vectors for
the token request and response protocol can be found in <span>[<a href="#ISSUANCE" class="cite xref">ISSUANCE</a>]</span>.<a href="#appendix-B-1" class="pilcrow">¶</a></p>
<div id="origin-name-encryption-test-vector">
<section id="appendix-B.1">
        <h3 id="name-origin-name-encryption-test">
<a href="#appendix-B.1" class="section-number selfRef">B.1. </a><a href="#name-origin-name-encryption-test" class="section-name selfRef">Origin Name Encryption Test Vector</a>
        </h3>
<p id="appendix-B.1-1">The test vector below for the procedure in <a href="#encrypt-origin" class="auto internal xref">Section 6</a> lists the following values:<a href="#appendix-B.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.1-2.1">
            <p id="appendix-B.1-2.1.1">origin_name: The Origin Name to encrypt, represented as a hexadecimal string.<a href="#appendix-B.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.2">
            <p id="appendix-B.1-2.2.1">kem_id, kdf_id, aead_id: The HPKE algorithms comprising the ciphersuite DHKEM(X25519, HKDF-SHA256), HKDF-SHA256, AES-128-GCM.<a href="#appendix-B.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.3">
            <p id="appendix-B.1-2.3.1">issuer_encap_key_seed: The seed used to derive the private key corresponding to
Issuer Encapsulation Key via the DeriveKeyPair function as defined in <span><a href="https://rfc-editor.org/rfc/rfc9180#section-7.1.3." class="relref">Section 7.1.3.</a> of [<a href="#HPKE" class="cite xref">HPKE</a>]</span>,
represented as a hexadecimal string.<a href="#appendix-B.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.4">
            <p id="appendix-B.1-2.4.1">issuer_encap_key: The public Issuer Encapsulation Key, represented as a hexadecimal string.<a href="#appendix-B.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.5">
            <p id="appendix-B.1-2.5.1">token_type: The type of the protocol specified in this document.<a href="#appendix-B.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.6">
            <p id="appendix-B.1-2.6.1">token_key_id: The ID of Token Key computed as in <a href="#request-one" class="auto internal xref">Section 5.3</a>, a single octet.<a href="#appendix-B.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.7">
            <p id="appendix-B.1-2.7.1">blinded_msg: A random blinded_msg value, represented as a hexadecimal string.<a href="#appendix-B.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.8">
            <p id="appendix-B.1-2.8.1">request_key: A random request_key value, represented as a hexadecimal string.<a href="#appendix-B.1-2.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.9">
            <p id="appendix-B.1-2.9.1">issuer_encap_key_id: The Issuer Encapsulation Key ID computed as in <a href="#request-one" class="auto internal xref">Section 5.3</a>, represented as a hexadecimal string.<a href="#appendix-B.1-2.9.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.1-2.10">
            <p id="appendix-B.1-2.10.1">encrypted_token_request: The encrypted InnerTokenRequest, represented as a hexadecimal string.<a href="#appendix-B.1-2.10.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="appendix-B.1-3">
<pre>
origin_name: 746573742e6578616d706c65
kem_id: 32
kdf_id: 1
aead_id: 1
issuer_encap_key_seed:
d2653816496f400baec656f213f1345092f4406af4f2a63e164956c4c3d240ca
issuer_encap_key: 010020d7b6a2c10e75c4239feb9897e8d23f3f3c377d78e7903611
53167736a24a9c5400010001
token_type: 3
token_key_id: 125
blinded_msg: 89da551a48270b053e53c9eb741badf89e43cb7e66366bb936e11fb2aa0
d30866986a790378bb9fc6a7cf5c32b7b7584d448ffa4ced3be650e354b3136428a52ec0
b27c4103c5855c2b9b4f521ad0713c800d7e6925b6c62e1a6f58b31d13335f468cf509b7
46a16e79b23862d277d0880706c3fb84b127d94faf8d6d2f3e124e681994441b19be084e
c5c159bcd0abab433bbc308d90ea2cabdf4216e1b07155be66a048d686e383ca1e517ab8
0025bb4849d98beb8c3d05d045c1167cb74f4451d8f85695babb604418385464f21f9a81
5fb850ed83fd16a966130427e5637816501f7a79c0010e06adeba55781ceb50f56eae152
ebd06f3cef80dc7ab121d
request_key: 0161d905e4e37f515cb61f863b60e5896aa9e4a17dbe238e752a144c64a
5412e244f0b1f75e010831e185cac023d33cb20
issuer_encap_key_id:
dd2c6de3091f1873643233d229a7a0e9defe0f9fe43f6a7c42ae3a6b16f77837
encrypted_token_request: 82ef7c068506bcabc27d068a51c7ead2cbaf600b76a15e4
d9df99a0da676da5a073fcc8f5ac77b25064d7379037b4e1b186977cface31eceb611978
c73c9aef38c9a0e8ae846881624fa6d454523a0a91d22b02b022891d0469deebd66a912a
a1ab3391b203e92e0a681f0a10c2a2d59b668daf1e5219ed16227d707fa0e8e29188bd58
7ab38b3584564ce9b6538ba82e301cfed4231a2fa4f64a67285a1b9bf648e25f3eb1644c
88d43552bdea6e4bfcbaef0de3ac245e0432be6b019494927fde0743b775f9efe8ca5fef
afbf2048890d54618d408a6001fc8fb276f6828c46f4fe1381e9775eec72ee47593df738
95d18952440d33756d78caea4bd8218950d35afa6c46c535211eda39da277260cb8dab7c
00c6840a745e8150a6ee4893e72b6a51382f877f8c05a15e891a2bde07049760f0f09879
78d78b97e47ecaf90a44996d724dd3720e308abbbf04f672bc5a4db573291986be191b06
03ff521accb6fa081c151c758f3092a89fc6ef591934ff4bc860896c57f83a31b237dd1b
803516c
</pre><a href="#appendix-B.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="issuers-origin-alias-test-vector">
<section id="appendix-B.2">
        <h3 id="name-issuers-origin-alias-test-v">
<a href="#appendix-B.2" class="section-number selfRef">B.2. </a><a href="#name-issuers-origin-alias-test-v" class="section-name selfRef">Issuer's Origin Alias Test Vector</a>
        </h3>
<p id="appendix-B.2-1">The test vector below for the procedure in <a href="#issuers-origin-alias" class="auto internal xref">Section 7</a> lists the following values:<a href="#appendix-B.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-B.2-2.1">
            <p id="appendix-B.2-2.1.1">sk_client: Client Secret, serialized and represented as a hexadecimal string.<a href="#appendix-B.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.2">
            <p id="appendix-B.2-2.2.1">pk_client: Client Key, serialized and represented as a hexadecimal string.<a href="#appendix-B.2-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.3">
            <p id="appendix-B.2-2.3.1">sk_origin: Origin Secret, serialized and represented as a hexadecimal string.<a href="#appendix-B.2-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.4">
            <p id="appendix-B.2-2.4.1">request_blind: The request_blind value computed in <a href="#index-request" class="auto internal xref">Section 7.1.1</a>, represented as a hexadecimal string.<a href="#appendix-B.2-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.5">
            <p id="appendix-B.2-2.5.1">index_key: The index_key value computed in <a href="#issuer-issuers-origin-alias" class="auto internal xref">Section 7.3</a>, represented as a hexadecimal string.<a href="#appendix-B.2-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-B.2-2.6">
            <p id="appendix-B.2-2.6.1">issuer_origin_alias: The issuer_origin_alias value computed in <a href="#attester-output-issuers-origin-alias" class="auto internal xref">Section 7.4</a>, represented as a hexadecimal string.<a href="#appendix-B.2-2.6.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<div class="alignLeft art-text artwork" id="appendix-B.2-3">
<pre>
sk_sign: f7a8996bfd0d4ef9af88b3eab73d9e05a2d8c557407236aa15e67b4c
8972bc57afb6562f0341dcc5e80fbb71811b9bbe
pk_sign: 032d276595b188b428e954f0cf61bebea9663a7d6678042a54bdb177
8fc88df7f03b83f7e2c15b14147f3487363f9dbd7a
sk_origin: 337d87ad143b414e05e7f764df402b8af14c20c34dc727dca027aa
87a5e1099f3760985813549a451ec42b0d7a377fdf
request_blind: 7444e18d84cad471dc07d8210b714493254776ff897f040feb
6e97a9a5f90f21d940ea7c50f8a5e3d9d8998c45ab7d42
request_key: 02168f9ec10377781d0b16370e7e97b02755741ad0e66e089696
080b4412ce56e933d47c22ff08a5d5da1474aa6b899b0a
index_key: 0284e8d968c696e57194db7b7a37814a1d7c9c2216106530561d07
adc87ff1b6b9c8b911711f5be66c165bbe90c280befb
issuer_origin_alias: ee475b7c158ff52a89ae21e7178ce572124ba6012a58
ba4124f0c691ffe4b40099637964891316264e8442f5f17aa5af
</pre><a href="#appendix-B.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-C">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Scott Hendrickson</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:scott@shendrickson.com" class="email">scott@shendrickson.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jana Iyengar</span></div>
<div dir="auto" class="left"><span class="org">Fastly</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jri@fastly.com" class="email">jri@fastly.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tommy Pauly</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tpauly@apple.com" class="email">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Steven Valdez</span></div>
<div dir="auto" class="left"><span class="org">Google LLC</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:svaldez@chromium.org" class="email">svaldez@chromium.org</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Cloudflare</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
